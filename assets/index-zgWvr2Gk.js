import{jsx as i,jsxs as C,Fragment as E}from"react/jsx-runtime";import*as wt from"react";import L,{useState as w,useCallback as z,useEffect as P,useRef as xt,useContext as J,useMemo as T}from"react";import{createRoot as pt}from"react-dom/client";import{toast as q,ToastContainer as Ot}from"react-toastify";import B from"leaflet";import{useMap as K,useMapEvent as St,MapContainer as Ht,LayersControl as $,TileLayer as Lt,GeoJSON as kt,useMapEvents as Pt}from"react-leaflet";import{Menu as ht,MenuItem as j,ListItem as N,ListItemText as X,ListItemIcon as It,IconButton as ut,List as Q,Collapse as Et,Button as tt,Tab as mt,Tabs as gt,useTheme as _t,useMediaQuery as et,Drawer as jt,Box as A,Typography as D}from"@mui/material";import{useSensors as Nt,useSensor as nt,PointerSensor as Bt,KeyboardSensor as Gt,DndContext as At,pointerWithin as Vt,DragOverlay as Dt,useDroppable as Tt}from"@dnd-kit/core";import{sortableKeyboardCoordinates as Ft,arrayMove as ft,useSortable as Rt}from"@dnd-kit/sortable";import{Editor as Wt}from"@tinymce/tinymce-react";import{CSS as $t}from"@dnd-kit/utilities";import Zt from"@mui/material/Button";import Ut from"@mui/material/Fade";import Jt from"@mui/material/Menu";import rt from"@mui/material/MenuItem";import ot from"file-saver";import Kt from"geojson-to-kml";import at from"jszip";import Xt from"turndown";import Yt from"axios";import{renderToString as it}from"react-dom/server";import qt from"react-image-gallery";import{v4 as Qt}from"uuid";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const p of o.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&r(p)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();const S=(t,e)=>{var n;return`${t}=${(n=e.properties)==null?void 0:n.id}`},V=t=>t?S(t.index,t.feature):"",W=L.createContext(void 0),Z="savedFeatures",te=({children:t})=>{const[e,n]=w(()=>{const l=localStorage.getItem(Z);return l?JSON.parse(l):{all:[]}}),r=z(()=>{localStorage.setItem(Z,JSON.stringify(e))},[e]),a=z(()=>{const l=localStorage.getItem(Z);l&&n(JSON.parse(l))},[]);P(()=>{r()},[e,r]);const o=z(l=>{n(typeof l=="function"?u=>l(u):l)},[n]),p=z((l,u)=>{o(g=>{const h=[...g[l]||[],u];return l==="all"?{...g,[l]:h}:{...g,[l]:h,all:g.all.filter(m=>{var f,v;return((f=m.properties)==null?void 0:f.id)!==((v=u.properties)==null?void 0:v.id)})}})},[o]),s=z((l,u)=>{if(!u){console.error("No selection info when trying to remove feature");return}o(g=>{const h=(g[l]||[]).filter((m,f)=>S(f,m)!==V(u));return{...g,[l]:h}})},[o]),c=z((l,u)=>{o(g=>{const h={...g};for(const m in h)h[m]=h[m].map(f=>{var v,y;return((v=f.properties)==null?void 0:v.id)===((y=l.properties)==null?void 0:y.id)?u:f});return h})},[o]),d={savedFeatures:e,addFeature:p,removeFeature:s,updateFeature:c,setSavedFeatures:o,saveToLocalStorage:r,loadFromLocalStorage:a};return i(W.Provider,{value:d,children:t})},ee={osm:{name:"OpenStreetMap",maxZoom:19,url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},CyclOSM:{name:"CyclOSM",maxZoom:20,url:"https://{s}.tile-cyclosm.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors. Tiles courtesy of <a href="https://www.openstreetmap.fr" target="_blank">OpenStreetMap France</a>'},esriWorldImagery:{name:"Esri World Imagery",maxZoom:20,url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"},esriWorldStreetMap:{name:"Esri World Street Map",maxZoom:20,url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"},esriWorldTopoMap:{name:"Esri World Topographic Map",maxZoom:20,url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"}},ne=()=>{const t=K();return St("moveend",()=>{const e=t.getCenter(),n=t.getZoom(),r={center:[e.lat,e.lng],zoom:n};localStorage.setItem("mapState",JSON.stringify(r))}),null},re=({center:t,zoom:e})=>{const n=K();return P(()=>{t&&e&&n.setView(t,e)},[t,e,n]),null};function oe(){const t=K(),[e,n]=w(t.getZoom()),r={background:"white",bottom:"10px",color:"black",left:"10px",padding:"5px",position:"absolute",zIndex:400};return P(()=>{const a=()=>{n(t.getZoom())};return t.on("zoomend",a),()=>{t.off("zoomend",a)}},[t]),C("div",{style:r,children:["Zoom: ",e]})}const ae=({children:t,center:e,overlays:n})=>{const r=xt(null),[a]=w("esriWorldStreetMap"),[o,p]=w({center:e,zoom:13}),s=z(()=>{const c=localStorage.getItem("mapState");c&&p(JSON.parse(c))},[]);return P(()=>{s()},[s]),i(E,{children:C(Ht,{center:o.center,zoom:o.zoom,ref:r,scrollWheelZoom:!0,style:{height:"100vh",width:"100%"},children:[i(ne,{}),i(re,{center:o.center,zoom:o.zoom}),i(oe,{}),C($,{position:"topright",children:[Object.entries(ee).map(([c,d])=>i($.BaseLayer,{name:d.name,checked:a===c,children:i(Lt,{attribution:d.attribution,url:d.url,maxZoom:d.maxZoom||20})},c)),n&&n.map(c=>i($.Overlay,{name:c.name,checked:c.checked,children:c.children},c.name))]}),t]})})};var vt={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},lt=L.createContext&&L.createContext(vt),ie=["attr","size","title"];function le(t,e){if(t==null)return{};var n=ce(t,e),r,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(a=0;a<o.length;a++)r=o[a],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function ce(t,e){if(t==null)return{};var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;n[r]=t[r]}return n}function F(){return F=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},F.apply(this,arguments)}function ct(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function R(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ct(Object(n),!0).forEach(function(r){se(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ct(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function se(t,e,n){return e=de(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function de(t){var e=pe(t,"string");return typeof e=="symbol"?e:e+""}function pe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function yt(t){return t&&t.map((e,n)=>L.createElement(e.tag,R({key:n},e.attr),yt(e.child)))}function M(t){return e=>L.createElement(he,F({attr:R({},t.attr)},e),yt(t.child))}function he(t){var e=n=>{var{attr:r,size:a,title:o}=t,p=le(t,ie),s=a||n.size||"1em",c;return n.className&&(c=n.className),t.className&&(c=(c?c+" ":"")+t.className),L.createElement("svg",F({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,r,p,{className:c,style:R(R({color:t.color||n.color},n.style),t.style),height:s,width:s,xmlns:"http://www.w3.org/2000/svg"}),o&&L.createElement("title",null,o),t.children)};return lt!==void 0?L.createElement(lt.Consumer,null,n=>e(n)):e(vt)}function ue(t){return M({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M11 18c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zm-2-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 4c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"},child:[]}]})(t)}function me(t){return M({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M13 5.7V4h3l-1-1.49L16 1h-5v4.7L2 12v10h7v-5l3.03-2L15 17v5h7V12z"},child:[]}]})(t)}function ge(t){return M({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M7 13c1.66 0 3-1.34 3-3S8.66 7 7 7s-3 1.34-3 3 1.34 3 3 3zm12-6h-8v7H3V5H1v15h2v-3h18v3h2v-9c0-2.21-1.79-4-4-4z"},child:[]}]})(t)}function fe(t){return M({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M11 9H9V2H7v7H5V2H3v7c0 2.12 1.66 3.84 3.75 3.97V22h2.5v-9.03C11.34 12.84 13 11.12 13 9V2h-2v7zm5-3v8h2.5v8H21V2c-2.76 0-5 2.24-5 4z"},child:[]}]})(t)}function ve(t){return M({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"},child:[]}]})(t)}function ye(t){return M({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M21 23c-1.03 0-2.06-.25-3-.75-1.89 1-4.11 1-6 0-1.89 1-4.11 1-6 0-.95.5-1.97.75-3 .75H2v-2h1c1.04 0 2.08-.35 3-1 1.83 1.3 4.17 1.3 6 0 1.83 1.3 4.17 1.3 6 0 .91.65 1.96 1 3 1h1v2h-1zM12 5.5c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 12s-1.52.71-3.93 1.37c-.82-.23-1.53-.75-2.07-1.37-.73.84-1.8 1.5-3 1.5s-2.27-.66-3-1.5c-.73.84-1.8 1.5-3 1.5s-2.27-.66-3-1.5c-.54.61-1.25 1.13-2.07 1.37C1.52 18.21 0 17.5 0 17.5s2.93-1.36 7.13-2.08l1.35-4.17c.31-.95 1.32-1.47 2.27-1.16.09.03.19.07.27.11l2.47 1.3 2.84-1.5 1.65-3.71-.51-1.32L18.8 2 22 3.43 20.67 6.4l-1.31.5-3.72 8.34c4.85.63 8.36 2.26 8.36 2.26zm-8.98-4.54-1.52.8-1.75-.92-.71 2.17c.32 0 .64-.01.96-.01.71 0 1.4.03 2.07.08l.95-2.12z"},child:[]}]})(t)}function be(t){return M({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M15 11V5l-3-3-3 3v2H3v14h18V11h-6zm-8 8H5v-2h2v2zm0-4H5v-2h2v2zm0-4H5V9h2v2zm6 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V9h2v2zm0-4h-2V5h2v2zm6 12h-2v-2h2v2zm0-4h-2v-2h2v2z"},child:[]}]})(t)}function ze(t){return M({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M21 4H7V2H5v20h2v-8h14l-2-5 2-5zm-3.86 5.74.9 2.26H7V6h11.05l-.9 2.26-.3.74.29.74zM14 9c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2z"},child:[]}]})(t)}function Me(t){return M({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M17 12h2L12 2 5.05 12H7l-3.9 6h6.92v4h3.95v-4H21l-4-6zM6.79 16l3.9-6H8.88l3.13-4.5 3.15 4.5h-1.9l4 6H6.79z"},child:[]}]})(t)}function Ce(t){return M({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M13.5 5.5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm4 5.28c-1.23-.37-2.22-1.17-2.8-2.18l-1-1.6c-.41-.65-1.11-1-1.84-1-.78 0-1.59.5-1.78 1.44S7 23 7 23h2.1l1.8-8 2.1 2v6h2v-7.5l-2.1-2 .6-3c1 1.15 2.41 2.01 4 2.34V23H19V9h-1.5v1.78zM7.43 13.13l-2.12-.41a.999.999 0 0 1-.79-1.17l.76-3.93a2 2 0 0 1 2.34-1.58l1.16.23-1.35 6.86z"},child:[]}]})(t)}const we=({contextMenu:t,contextMenuTab:e,handleClose:n,moveCategory:r,handleRenameCategory:a,handleAddCategory:o,handleRemoveCategory:p})=>{const s=z(()=>{if(!e)return;const d=prompt("Enter new name for category",e);d&&d!==e&&a(d)},[e,a]),c=d=>l=>{d(l),n()};return e?C(ht,{open:t!==null,onClose:n,anchorReference:"anchorPosition",anchorPosition:t!==null?{top:t.mouseY,left:t.mouseX}:void 0,children:[e&&e!=="all"?C(E,{children:[i(j,{onClick:c(()=>r("up")),children:"Move Up"}),i(j,{onClick:c(()=>r("down")),children:"Move Down"}),i(j,{onClick:c(s),children:"Rename Category"}),i(j,{onClick:c(p),children:"Remove Category"})]}):null,i(j,{onClick:c(o),children:"Add New Category"})]}):i(E,{})},xe=({contextMenu:t,contextMenuFeature:e,handleClose:n,handleDuplicate:r,handleRemoveFromList:a,handleRemoveCompletely:o})=>{if(!e)return i(E,{});const p=s=>c=>{s(c),n()};return i(ht,{open:t!==null,onClose:n,anchorReference:"anchorPosition",anchorPosition:t!==null?{top:t.mouseY,left:t.mouseX}:void 0,children:e&&C(E,{children:[i(j,{onClick:p(r),children:"Duplicate"}),e.category!="all"&&i(j,{onClick:p(a),children:"Remove from this list"}),i(j,{onClick:p(o),children:"Remove"})]})})},Oe=({children:t,savedFeatures:e,selectedTab:n,setSavedFeatures:r})=>{var l,u;const[a,o]=w(null),p=Nt(nt(Bt),nt(Gt,{coordinateGetter:Ft})),s=z(g=>{o(g.active.id.toString())},[]),c=z(g=>{var f,v;const{active:h,over:m}=g;if(m&&h.id!==m.id){const y=e[n].find((b,x)=>S(x,b)===h.id);if(y){const b=n;let x=n;if(((v=(f=m.data)==null?void 0:f.current)==null?void 0:v.type)==="tab"&&(x=m.id.toString()),b!==x)r(O=>{const H={...O};return H[b]=H[b].filter((_,I)=>S(I,_)!==h.id),H[x]=[...H[x],y],H});else{const O=e[b].findIndex((I,G)=>S(G,I)===h.id),H=e[b].findIndex((I,G)=>S(G,I)===m.id),_=ft(e[b],O,H);r(I=>({...I,[b]:_}))}}}o(null)},[e,n,r]),d=z(()=>{o(null)},[]);return C(At,{sensors:p,collisionDetection:Vt,onDragStart:s,onDragEnd:c,onDragCancel:d,children:[t,i(Dt,{children:a?i(N,{children:i(X,{primary:((u=(l=e[n].find((g,h)=>S(h,g)===a))==null?void 0:l.properties)==null?void 0:u.name)||"Unnamed Feature"})}):null})]})},Se={"tinymce-editor":"_tinymce-editor_10zer_1"},He=({initialText:t,onChange:e})=>{const[n,r]=w(t),a=o=>{typeof o=="string"&&(r(o),e(o))};return i("div",{className:Se["tinymce-editor"],children:i(Wt,{onChange:a,init:{height:400,width:"100%",menubar:!1,plugins:["lists","advlist","fullscreen","autolink","charmap","code","image","link","table"],toolbar:["undo redo bold italic backcolor image charmap link | advlist bullist numlist outdent indent table | code  fullscreen"],skin_url:"./tinymce/skins/ui/oxide"},value:n,onEditorChange:a,licenseKey:"gpl"})})},Le=({feature:t,id:e,index:n,selectedTab:r,selectedFeature:a,setSelectedFeature:o,handleContextMenu:p})=>{var v;const{attributes:s,listeners:c,setNodeRef:d,transform:l,transition:u,isDragging:g}=Rt({id:e}),h={transform:$t.Transform.toString(l),transition:u,opacity:g?.5:1,border:g?"dashed":""},m=V(a)===S(n,t),f={feature:t,index:n,category:r};return C(N,{ref:d,style:h,onClick:y=>{y.stopPropagation(),o(m?null:f)},onContextMenu:y=>{p(y,f),y.stopPropagation()},button:"true",children:[i(It,{children:i(ut,{edge:"start","aria-label":"drag",...c,...s,sx:{cursor:"grab","&:active":{cursor:"grabbing"}},children:i(ue,{})})}),i(X,{primary:((v=t.properties)==null?void 0:v.name)||"Unnamed Feature"})]})},ke=({features:t,setSavedFeatures:e,selectedTab:n,selectedFeature:r,setSelectedFeature:a,handleContextMenu:o,excludedProperties:p})=>{const[s,c]=w(!1),[d,l]=w(""),u=m=>{var f;s?(c(!1),l("")):(l(((f=m.properties)==null?void 0:f.tripNotes)||""),c(!0))},g=m=>{l(m)},h=()=>{r&&e(m=>{const f=[...m[n]],v=f.findIndex((y,b)=>S(b,y)===V(r));return v!==-1&&f[v].properties&&(f[v].properties.tripNotes=d),{...m,[n]:f}})};return P(()=>{!r&&s&&(c(!1),l(""))},[s,r,l,c]),i(Q,{children:t.map((m,f)=>C(L.Fragment,{children:[i(Le,{feature:m,id:S(f,m),index:f,selectedTab:n,selectedFeature:r,setSelectedFeature:a,handleContextMenu:o}),C(Et,{in:V(r)===S(f,m),timeout:"auto",unmountOnExit:!0,children:[i(N,{sx:{pl:4},children:i(tt,{onClick:()=>u(m),children:"Add/edit notes"})}),s&&C(E,{children:[i(N,{sx:{pl:4},children:i(He,{initialText:d,onChange:g},S(f,m))}),i(N,{sx:{pl:4},children:i(tt,{onClick:h,children:"Save notes"})})]}),i(Q,{component:"div",disablePadding:!0,children:Object.entries(m.properties||{}).filter(([v])=>!p.includes(v)).map(([v,y])=>i(N,{sx:{pl:4},children:i(X,{primary:`${v}: ${y}`})},v))})]})]},S(f,m)))})},Pe=({tab:t,onContextMenu:e,value:n,...r})=>{const{setNodeRef:a,node:o}=Tt({id:t,data:{category:t,type:"tab"}});return i(mt,{ref:a,label:t,value:n,onContextMenu:e,sx:{border:o!=null&&o.rect?"1px dashed #ccc":"none"},...r})},Ie=({tabs:t,selectedTab:e,handleTabChange:n,handleTabContextMenu:r})=>i(gt,{orientation:"vertical",variant:"scrollable",value:e,onChange:n,"aria-label":"Saved Features Tabs",sx:{height:"100%"},children:t.map(a=>i(Pe,{tab:a,value:a,onContextMenu:o=>r(o,a)},a))}),Ee=t=>{var n,r,a,o,p;const e={...t};if(e.properties||(e.properties={}),(n=t.properties)!=null&&n.tripNotes){const c=new Xt().turndown(t.properties.tripNotes);c&&(e.properties.description=c+`

--------------------

`+e.properties.description)}return(r=e.properties)==null||delete r.id,(a=e.properties)==null||delete a.style,(o=e.properties)==null||delete o.images,(p=e.properties)==null||delete p.tripNotes,e},_e=({savedFeatures:t})=>{const[e,n]=wt.useState(null),r=!!e,a=d=>{n(d.currentTarget)},o=()=>{n(null)},p=d=>l=>{d(l),o()},s=z(()=>{const d=new at;Object.entries(t).map(([l,u])=>{const g={type:"FeatureCollection",features:u};d.file(`${l}.geojson`,JSON.stringify(g))}),d.generateAsync({type:"blob"}).then(l=>{ot.saveAs(l,"trip_explorer_features.json.zip")})},[t]),c=z(()=>{const d=new at;Object.entries(t).map(([l,u])=>{const g={type:"FeatureCollection",features:u.map(m=>Ee(m))},h=Kt(g);d.file(`${l}.kml`,h)}),d.generateAsync({type:"blob"}).then(l=>{ot.saveAs(l,"trip_explorer_features.kml.zip")})},[t]);return C("div",{children:[i(Zt,{id:"fade-button","aria-controls":r?"fade-menu":void 0,"aria-haspopup":"true","aria-expanded":r?"true":void 0,onClick:a,children:"Export"}),C(Jt,{id:"fade-menu",MenuListProps:{"aria-labelledby":"fade-button"},anchorEl:e,open:r,onClose:o,TransitionComponent:Ut,children:[i(rt,{onClick:p(s),children:"To GeoJson"}),i(rt,{onClick:p(c),children:"To KML"})]})]})},je=(t,e,n,r)=>{const a=z(c=>{if(!r||r==="all")return;const d=Object.keys(n),l=d.indexOf(r);if(l===-1)return;let u;if(c==="up"&&l>1)u=l-1;else if(c==="down"&&l<d.length-1)u=l+1;else return;const g=ft(d,l,u),h=Object.fromEntries(g.map(m=>[m,n[m]]));t(h)},[r,n,t]),o=z(c=>{r&&r!=="all"&&c!=="all"&&t(d=>{const l={...d};l[c]=l[r],delete l[r];const u=Object.keys(l),g=u.indexOf(r);return g!==-1&&u.splice(g,1,c),Object.fromEntries(u.map(h=>[h,l[h]]))})},[r,t]),p=z(()=>{let c=prompt("Enter name for category");(!c||Object.keys(n).includes(c))&&(c=`Category_${Object.keys(n).length}`),t(d=>({...d,[c]:[]}))},[n,t]),s=z(()=>{if(r&&r!=="all"){t(u=>{const g=u[r],h={...u};return delete h[r],h.all=[...h.all,...g],h});const c=Object.keys(n),d=c.indexOf(r),l=c[d-1];e(l)}},[r,t,e,n]);return{moveCategory:a,handleRenameCategory:o,handleAddCategory:p,handleRemoveCategory:s}},Ne=()=>{const[t,e]=w(null),[n,r]=w(null),[a,o]=w(null),p=z((d,l,u)=>{d.preventDefault(),e({mouseX:d.clientX+2,mouseY:d.clientY-6}),o(l||null),r(u||null)},[]),s=z((d,l)=>{p(d,void 0,l)},[p]),c=z(()=>{e(null),r(null),o(null)},[]);return{contextMenu:t,contextMenuTab:n,contextMenuFeature:a,handleContextMenu:p,handleTabContextMenu:s,handleClose:c}},Be=(t,e,n,r)=>{const a=z(()=>{n&&t(s=>({...s,[e]:[...s[e],n.feature]}))},[n,e,t]),o=z(()=>{n&&e!=="all"&&(r(e,n),t(s=>({...s,all:[...s.all,n.feature]})))},[n,e,r,t]),p=z(()=>{n&&(r(e,n),t(s=>({...s,all:s.all.filter((c,d)=>S(d,c)!==V(n))})))},[n,e,r,t]);return{handleDuplicate:a,handleRemoveFromList:o,handleRemoveCompletely:p}},Ge=()=>{const[t,e]=w(null),n=z(r=>{e(a=>a===r?null:r)},[]);return{selectedFeature:t,setSelectedFeature:n}},Ae=["id","images","style"],Ve=({drawerOpen:t,onClose:e,setCurrentCategory:n})=>{const[r,a]=w("all"),{savedFeatures:o,setSavedFeatures:p,removeFeature:s}=J(W),{selectedFeature:c,setSelectedFeature:d}=Ge(),{contextMenu:l,contextMenuTab:u,contextMenuFeature:g,handleContextMenu:h,handleTabContextMenu:m,handleClose:f}=Ne(),{moveCategory:v,handleRenameCategory:y,handleAddCategory:b,handleRemoveCategory:x}=je(p,a,o,u),{handleDuplicate:O,handleRemoveFromList:H,handleRemoveCompletely:_}=Be(p,r,g,s),I=_t(),G=et(I.breakpoints.up("sm")),Y=et(I.breakpoints.up("md"))?"30%":G?"50%":"80%",Mt=z((M1,Ct)=>{a(Ct),d(null)},[d]);return P(()=>{n&&n(r)},[r,n]),C(E,{children:[i(ut,{onClick:e,style:{position:"absolute",top:10,left:40,zIndex:1e3},children:i(ve,{})}),C(Oe,{savedFeatures:o,selectedTab:r,setSavedFeatures:p,children:[C(jt,{anchor:"left",open:t,onClose:e,sx:{width:Y,flexShrink:0,"& .MuiDrawer-paper":{width:Y,boxSizing:"border-box"}},children:[i(A,{sx:{display:"flex",height:"50px",border:"1px solid #ccc"},children:i(_e,{savedFeatures:o})}),C(A,{sx:{display:"flex",height:"100%"},children:[i(A,{sx:{width:150,bgcolor:"background.paper",borderRight:1,borderColor:"divider"},children:i(Ie,{tabs:Object.keys(o),selectedTab:r,handleTabChange:Mt,handleTabContextMenu:m})}),i(A,{sx:{flexGrow:1,overflowY:"auto"},children:i(ke,{features:o[r]||[],setSavedFeatures:p,selectedTab:r,selectedFeature:c,setSelectedFeature:d,handleContextMenu:h,excludedProperties:Array.from(Ae)})})]})]}),i(we,{contextMenu:l,contextMenuTab:u,handleClose:f,moveCategory:v,handleRenameCategory:y,handleAddCategory:b,handleRemoveCategory:x}),i(xe,{contextMenu:l,contextMenuFeature:g,handleClose:f,handleDuplicate:O,handleRemoveFromList:H,handleRemoveCompletely:_})]})]})};function bt(t,e){const n={...t};return U(t)&&U(e)&&Object.keys(e).forEach(r=>{U(e[r])?r in t?n[r]=bt(t[r],e[r]):Object.assign(n,{[r]:e[r]}):Object.assign(n,{[r]:e[r]})}),n}function U(t){return t&&typeof t=="object"&&!Array.isArray(t)}const De=t=>{const[e,n]=w({}),[r,a]=w(!0),[o,p]=w(null);return P(()=>{(async()=>{a(!0);try{const c={},l=t.map(async h=>{const m=await Yt.get(h,c);return[h,m.data]}),g=(await Promise.all(l)).reduce((h,[m,f])=>{const v=f.properties||{};return f.features.forEach(y=>{if(y.type!=="Feature"){console.warn("Skipping non-feature item in features array");return}y.properties={...v,...y.properties},Object.keys(v).forEach(b=>{var x;if(typeof v[b]=="object"&&v[b]!==null){const O=(x=y.properties)==null?void 0:x[b];typeof O=="object"&&O!==null?y.properties[b]=bt(v[b],O):y.properties[b]=v[b]}})}),h[m]=f,h},{});n(g)}catch(c){c instanceof Error&&p(c.message)}finally{a(!1)}})()},[t]),r?{...e,loading:!0}:o?(console.error(o),{...e,error:o}):e},Te="_scrollableContent_1yrb0_1",Fe="_popupContent_1yrb0_10",Re="_tabsContainer_1yrb0_15",k={scrollableContent:Te,popupContent:Fe,tabsContainer:Re};function We(t){return M({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M2.52 3.515A2.5 2.5 0 0 1 4.82 2h6.362c1 0 1.904.596 2.298 1.515l.792 1.848c.075.175.21.319.38.404.5.25.855.715.965 1.262l.335 1.679q.05.242.049.49v.413c0 .814-.39 1.543-1 1.997V13.5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-1.338c-1.292.048-2.745.088-4 .088s-2.708-.04-4-.088V13.5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-1.892c-.61-.454-1-1.183-1-1.997v-.413a2.5 2.5 0 0 1 .049-.49l.335-1.68c.11-.546.465-1.012.964-1.261a.8.8 0 0 0 .381-.404l.792-1.848ZM3 10a1 1 0 1 0 0-2 1 1 0 0 0 0 2m10 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6 8a1 1 0 0 0 0 2h4a1 1 0 1 0 0-2zM2.906 5.189a.51.51 0 0 0 .497.731c.91-.073 3.35-.17 4.597-.17s3.688.097 4.597.17a.51.51 0 0 0 .497-.731l-.956-1.913A.5.5 0 0 0 11.691 3H4.309a.5.5 0 0 0-.447.276L2.906 5.19Z"},child:[]}]})(t)}function $e(t){return M({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M8 3a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 3m8 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5m-13.5.5a.5.5 0 0 0 0-1h-2a.5.5 0 0 0 0 1zm11.157-6.157a.5.5 0 0 1 0 .707l-1.414 1.414a.5.5 0 1 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0m-9.9 2.121a.5.5 0 0 0 .707-.707L3.05 5.343a.5.5 0 1 0-.707.707zM8 7a4 4 0 0 0-4 4 .5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5 4 4 0 0 0-4-4m0 1a3 3 0 0 1 2.959 2.5H5.04A3 3 0 0 1 8 8"},child:[]}]})(t)}function Ze(t){return M({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M3 2.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 .5.5v5a.5.5 0 0 1-.5.5h-5a.5.5 0 0 1-.5-.5z"},child:[]},{tag:"path",attr:{d:"M1 2a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v8a2 2 0 0 1 2 2v.5a.5.5 0 0 0 1 0V8h-.5a.5.5 0 0 1-.5-.5V4.375a.5.5 0 0 1 .5-.5h1.495c-.011-.476-.053-.894-.201-1.222a.97.97 0 0 0-.394-.458c-.184-.11-.464-.195-.9-.195a.5.5 0 0 1 0-1q.846-.002 1.412.336c.383.228.634.551.794.907.295.655.294 1.465.294 2.081v3.175a.5.5 0 0 1-.5.501H15v4.5a1.5 1.5 0 0 1-3 0V12a1 1 0 0 0-1-1v4h.5a.5.5 0 0 1 0 1H.5a.5.5 0 0 1 0-1H1zm9 0a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v13h8z"},child:[]}]})(t)}function Ue(t){return M({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M7.293 1.5a1 1 0 0 1 1.414 0L11 3.793V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v3.293l2.354 2.353a.5.5 0 0 1-.708.708L8 2.207l-5 5V13.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 1 0 1h-4A1.5 1.5 0 0 1 2 13.5V8.207l-.646.647a.5.5 0 1 1-.708-.708z"},child:[]},{tag:"path",attr:{d:"M16 12.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0m-3.5-2a.5.5 0 0 0-.5.5v1.5a.5.5 0 1 0 1 0V11a.5.5 0 0 0-.5-.5m0 4a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1"},child:[]}]})(t)}function Je(t){return M({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"},child:[]},{tag:"path",attr:{d:"M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1z"},child:[]}]})(t)}function Ke(t){return M({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 448h-24.68L359.54 117.75l53.41-73.55c5.19-7.15 3.61-17.16-3.54-22.35l-25.9-18.79c-7.15-5.19-17.15-3.61-22.35 3.55L320 63.3 278.83 6.6c-5.19-7.15-15.2-8.74-22.35-3.55l-25.88 18.8c-7.15 5.19-8.74 15.2-3.54 22.35l53.41 73.55L40.68 448H16c-8.84 0-16 7.16-16 16v32c0 8.84 7.16 16 16 16h608c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16zM320 288l116.36 160H203.64L320 288z"},child:[]}]})(t)}function Xe(t){return M({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M616 192H480V24c0-13.26-10.74-24-24-24H312c-13.26 0-24 10.74-24 24v72h-64V16c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v80h-64V16c0-8.84-7.16-16-16-16H80c-8.84 0-16 7.16-16 16v80H24c-13.26 0-24 10.74-24 24v360c0 17.67 14.33 32 32 32h576c17.67 0 32-14.33 32-32V216c0-13.26-10.75-24-24-24zM128 404c0 6.63-5.37 12-12 12H76c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm0-96c0 6.63-5.37 12-12 12H76c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm0-96c0 6.63-5.37 12-12 12H76c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm128 192c0 6.63-5.37 12-12 12h-40c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm0-96c0 6.63-5.37 12-12 12h-40c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm0-96c0 6.63-5.37 12-12 12h-40c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm160 96c0 6.63-5.37 12-12 12h-40c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm0-96c0 6.63-5.37 12-12 12h-40c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm0-96c0 6.63-5.37 12-12 12h-40c-6.63 0-12-5.37-12-12V76c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm160 288c0 6.63-5.37 12-12 12h-40c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm0-96c0 6.63-5.37 12-12 12h-40c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40z"},child:[]}]})(t)}function Ye(t){return M({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M172.268 501.67C26.97 291.031 0 269.413 0 192 0 85.961 85.961 0 192 0s192 85.961 192 192c0 77.413-26.97 99.031-172.268 309.67-9.535 13.774-29.93 13.773-39.464 0z"},child:[]}]})(t)}function qe(t){return M({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M206.86 245.15c-35.88 10.45-59.95 41.2-57.53 74.1 11.4-12.72 28.81-23.7 49.9-30.92l7.63-43.18zM95.81 295L64.08 115.49c-.29-1.62.28-2.62.24-2.65 57.76-32.06 123.12-49.01 189.01-49.01 1.61 0 3.23.17 4.85.19 13.95-13.47 31.73-22.83 51.59-26 18.89-3.02 38.05-4.55 57.18-5.32-9.99-13.95-24.48-24.23-41.77-27C301.27 1.89 277.24 0 253.32 0 176.66 0 101.02 19.42 33.2 57.06 9.03 70.48-3.92 98.48 1.05 126.58l31.73 179.51c14.23 80.52 136.33 142.08 204.45 142.08 3.59 0 6.75-.46 10.01-.8-13.52-17.08-28.94-40.48-39.5-67.58-47.61-12.98-106.06-51.62-111.93-84.79zm97.55-137.46c-.73-4.12-2.23-7.87-4.07-11.4-8.25 8.91-20.67 15.75-35.32 18.32-14.65 2.58-28.67.4-39.48-5.17-.52 3.94-.64 7.98.09 12.1 3.84 21.7 24.58 36.19 46.34 32.37 21.75-3.82 36.28-24.52 32.44-46.22zM606.8 120.9c-88.98-49.38-191.43-67.41-291.98-51.35-27.31 4.36-49.08 26.26-54.04 54.36l-31.73 179.51c-15.39 87.05 95.28 196.27 158.31 207.35 63.03 11.09 204.47-53.79 219.86-140.84l31.73-179.51c4.97-28.11-7.98-56.11-32.15-69.52zm-273.24 96.8c3.84-21.7 24.58-36.19 46.34-32.36 21.76 3.83 36.28 24.52 32.45 46.22-.73 4.12-2.23 7.87-4.07 11.4-8.25-8.91-20.67-15.75-35.32-18.32-14.65-2.58-28.67-.4-39.48 5.17-.53-3.95-.65-7.99.08-12.11zm70.47 198.76c-55.68-9.79-93.52-59.27-89.04-112.9 20.6 25.54 56.21 46.17 99.49 53.78 43.28 7.61 83.82.37 111.93-16.6-14.18 51.94-66.71 85.51-122.38 75.72zm130.3-151.34c-8.25-8.91-20.68-15.75-35.33-18.32-14.65-2.58-28.67-.4-39.48 5.17-.52-3.94-.64-7.98.09-12.1 3.84-21.7 24.58-36.19 46.34-32.37 21.75 3.83 36.28 24.52 32.45 46.22-.73 4.13-2.23 7.88-4.07 11.4z"},child:[]}]})(t)}function Qe(t){return M({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M507.31 72.57L439.43 4.69c-6.25-6.25-16.38-6.25-22.63 0l-22.63 22.63c-6.25 6.25-6.25 16.38 0 22.63l-76.67 76.67c-46.58-19.7-102.4-10.73-140.37 27.23L18.75 312.23c-24.99 24.99-24.99 65.52 0 90.51l90.51 90.51c24.99 24.99 65.52 24.99 90.51 0l158.39-158.39c37.96-37.96 46.93-93.79 27.23-140.37l76.67-76.67c6.25 6.25 16.38 6.25 22.63 0l22.63-22.63c6.24-6.24 6.24-16.37-.01-22.62zM179.22 423.29l-90.51-90.51 122.04-122.04 90.51 90.51-122.04 122.04z"},child:[]}]})(t)}function t1(t){return M({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M25 41v446h30V41zm56.8 40.15c-.1 14.49 1.03 25.35 3.31 32.75 2.77 8.9 6.33 12.9 12.45 16 11.34 5.7 35.34 5.3 70.54 5.1.8-8.5-.5-15.1-3.2-20.4-3.5-6.8-9.4-12.2-18.1-16.86-15.4-8.19-39.1-12.83-65-16.59zM457 105v382h30V105zM73 153v46h238v-46zm256 0v46h110v-46zm-18 64v158h18v-46h110v-18H329v-46h110v-18H329v-30zM81.79 321.3c-.1 14.4 1.03 25.3 3.3 32.6 2.78 9 6.33 13 12.46 16 11.35 5.7 35.35 5.3 70.55 5.1.8-8.5-.5-15-3.2-20.3-3.4-6.8-9.4-12.2-18.1-16.8-15.4-8.2-39.1-12.8-65.01-16.6zM73 393v46h238v-46zm256 0v46h110v-46z"},child:[]}]})(t)}function e1(t){return M({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M47 145c-10 0-23 12.4-23 24.9v134.3l52.49 7.5C84.97 297 100.9 287 119 287c21 0 39 13.3 45.9 32h188.2c6.9-18.7 24.9-32 45.9-32s39 13.3 45.9 32H488v-77.2L456.5 145zm-9 14h405.6l25.6 82H296v64h-98v-64H38zm18 18v46h62v-46zm80 0v46h62v-46zm80 0v110h22V177zm40 0v110h22V177zm40 0v46h62v-46zm86.6 0v46h62.2l-14.4-46zM119 305c-17.2 0-31 13.8-31 31s13.8 31 31 31 31-13.8 31-31-13.8-31-31-31zm280 0c-17.2 0-31 13.8-31 31s13.8 31 31 31 31-13.8 31-31-13.8-31-31-31zm-280 23a8 8 0 0 1 8 8 8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8zm280 0a8 8 0 0 1 8 8 8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8z"},child:[]}]})(t)}function n1(t){return M({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M247 80v53h-26v48h-34.027l-2.54 18.154-38.408-3.205-2.05 18.102 37.988 2.994-4.578 34.312-25.592 13.96 22.006 65.107a1658.637 1658.637 0 0 0-137.914 15.91l2.812 17.777a1639.075 1639.075 0 0 1 121.096-14.529l-.078.31c112.547 28.156 190.551 43.088 306.816-8.958l-7.355-16.43a485.085 485.085 0 0 1-26.844 11.092c-29.894-4.015-61.118-6.653-93.156-8.053l21.031-62.227-25.592-13.959L325.027 181H291v-48h-26V80h-18zm-8 71h34v30h-34v-30zm-35.973 48h103.946l6.16 40.639L256 211.748l-57.133 27.89 4.16-40.638zM256 232.252v94.346c-5.41.103-10.833.238-16.262.402h-46.46l-21.071-52.316L256 232.252zM298.17 254c8.836 0 16 7.163 16 16s-7.164 16-16 16c-8.837 0-16-7.163-16-16s7.163-16 16-16zm-56.92 91h82.404c22.502.709 44.618 2.01 66.149 3.96-58.924 14.561-109.381 9.793-169.532-3.194A1523.33 1523.33 0 0 1 241.25 345zm-132.865 29.363c-7.943-.023-15.667.234-23.084.842l1.469 17.941c54.39-4.455 133.014 12.49 189.199 17.202 55.64 4.665 109.966-1.684 168.654-13.512l-3.557-17.645c-57.8 11.65-110.279 17.692-163.591 13.221-47.153-3.954-113.49-17.885-169.09-18.049zm20.22 35.285c-12.198-.079-25.387.615-38.517 1.873-26.26 2.518-51.6 7.157-67.865 14.26l7.203 16.496c12.302-5.372 37.244-10.427 62.38-12.838 25.138-2.41 51.157-2.311 65.846.625 32.956 6.589 91.409 16.938 138.62 15.444l-.569-17.99c-44.053 1.394-102.073-8.619-134.523-15.106-9.17-1.833-20.376-2.684-32.575-2.764z"},child:[]}]})(t)}function r1(t){return M({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M236.422 98.393c-126.642-1.276-206.07 46.77-212.058 83.93-2.977 41.18-4.165 83.628-4.016 124.617l4.31 3.796c3.963-15.315 6.47-31.843 14.122-44.085 1.3 27.18 5.068 58.562 11.369 82.067-2.477 24.988-2.118 47.99-3.436 72.978 21.158 12.726 60.485 10.65 67.541 1.986 2.936-20.695 4.981-42.58 3.973-68.535l7.592-35.355c6.418-14.587 25.29-17.243 23.406-31.799l17.828-2.467c.355 25.196-14.375 27.1-24.713 41.653 12.994 5.357 14.676 3.886 24.059 5.124 23.848 2.742 45.234 3.774 67.802-8.175l-3.101-17.541 17.723-3.135 3.064 17.328c4.22 14.097 11.996 104.392 18.559 108.361 13.411 6.417 53.823 6.417 55.472-5.312 1.647-45.786 3.861-90.1-5.07-133.242 3.702-4.1 7.34-8.112 10.928-12.096-20.178-10.157-44.214-25.838-57.62-41.797-9.037-17.21-13.75-38.688-17.304-56.256-2.546-12.943-4.3-26.074-3.81-37.486.244-5.706 1.003-11.018 2.982-15.938 19.848-20.186 56.606-35.68 79.58-46.503-33.273-7.269-71.55 7.386-99.182 17.882zm128.934-9.931c-29.757 10.977-72.215 22.174-92.633 45.267-.807 2.008-1.51 5.563-1.7 9.994-.38 8.863 1.097 21.093 3.487 33.243 2.39 12.15 5.644 24.32 8.53 33.642 1.442 4.662 2.797 8.624 3.865 11.44 15.216 22.215 45.646 39.625 67.966 44.959l14.495-28.713c-11.574-15.04-13.779-35.226-4.59-50.352 4.932-6.143 9.727-10.553 16.982-10.416 4.545.109 9.194 1.996 12.856 5.045 25.905 21.572 49.481 48.69 83.37 70.66-.136-6.626-.26-12.94-.243-18.761.026-9.03-18.924-97.759-50.614-139.553-22.918-5.83-40.343-9.14-61.771-6.455zm68.883 76.232c4.327-.07 8.421.563 11.857 2.319.061 4.922-.298 10.035-10.887 16.152-4.501-4.72-11.239-10.838-17.908-15.627 5.427-1.506 11.374-2.754 16.938-2.844zm-54.233 32.838c-2.263 3.593-3.912 11.657-2.703 17.531 1.402 6.812 9.062 16.901 21.55 26.47 12.49 9.567 29.242 18.77 46.753 26.087 15.609 6.522 31.748 11.435 46.058 14.19-49.78-25.118-79.482-61.19-108.566-85.409-1.548-1.595-2.387.034-3.092 1.131zm58.914 86.797c.526 23.427-2.416 50.265-17.086 59.894-11.128 7.306-33.235 1.34-38.41-10.925-3.657-8.667 15.567-15.677 13.408-24.832-1.718-7.287-11.033-14.374-18.375-12.912-17.881 3.558-34.905 28.836-29.3 46.185 10.14 31.387 62.177 51.105 91.875 36.75 27.49-13.288 35.058-46.714 36.808-81.19-12.704-3.13-25.983-7.579-38.92-12.97zm-200.681 52.52a129.415 129.415 0 0 1-9.993 4.34l-8.67 77.603c1.22 8.802 15.819 12.647 30.385 12.81zm-100.65 4.519c-1.341 10.733-2.367 21.785-3.073 30.953-1.545 20.225-2.483 41.562-2.496 51.49 18.869 11.927 54.798 4.533 53.105-2.005-.656-27.278-6.002-49.806-12.58-73.717-11.983-1.258-23.524-3.864-34.957-6.721z"},child:[]}]})(t)}function o1(t){return M({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M279.27 114.408l-2.297 9.184H87v18h185.473l-7.5 30h46.054l-7.5-30H489v-18H299.027l-2.297-9.184h-17.46zM26.623 173.592l14.62 87.724-12.757 38.276H44.27l32.548-32.547L197.94 284.35l2.11 4.216c7.196 14.39 18.094 25.306 28.942 32.538C239.84 328.334 251 331.592 256 331.592h128c23 0 46.04-3.978 62.346-11.225 8.152-3.623 14.546-8.035 18.63-12.703 1.744-1.993 3.066-3.993 4.034-6.072H314.066l-48-112H259l-64 48H74.437l-32-64H26.623zm259.025 16l40.286 94h44.418l-40.286-94h-44.418zm64.2.47l40.086 93.53h79.138c-7.773-34.538-24.96-56.882-47.127-71.49-20.674-13.625-46.067-20.328-72.097-22.04zm46.525 159.186c-4.108.223-8.24.344-12.373.344h-6.488l10 30h-87.024l10-30h-18.976l-10 30H199v18h251.967l24.02-17.764 7.236-5.35-10.703-14.474-7.237 5.35-19.25 14.238h-38.545l-10.115-30.344z"},child:[]}]})(t)}function a1(t){return M({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M424.188 85.594c.33.05-.86.094-3.313.094-18.512 0-35.78 20.06-35.78 47.5 0 13.83 4.712 26.208 11.624 34.78l10.217 12.626-16.062 2.47c-10.56 1.617-17.663 6.432-23.625 14.342s-10.344 19.18-13.25 32.344c-5.186 23.492-5.59 52.425-5.625 78.156h30.438l.593 8.72 7.094 106.593h65.813l8.03-106.69.657-8.624h32c-.24-25.383-1.62-53.933-7.344-77.25-3.213-13.086-7.783-24.354-13.687-32.375-5.905-8.02-12.7-12.85-22.064-14.593l-15.72-2.937 10.283-12.25c7.228-8.623 12.186-21.138 12.186-35.313 0-25.74-15.5-45.406-32.28-47.562l-.188-.03zm-244.75 3.375c-45.9.006-99.844 5.373-161.625 17.905V126c268.018-37.648 341.545 38.15 226.25 79.344-117.327 41.92-210.503 252.258 159.406 270.594 4.362.438 8.85.687 13.436.687 22.28 0 42.34-5.452 56.125-13.594 13.787-8.14 20.595-18.14 20.595-27.905s-6.808-19.764-20.594-27.906c-.23-.138-.482-.272-.717-.408l-2 26.47-.657 8.656H369l-.563-8.75-3.28-49.5c-128.194 2.8-163.256-100.51-80.094-130.47 20.385-7.344 37.086-15.836 50.187-25.03.17-.822.32-1.655.5-2.47 3.262-14.774 8.256-28.498 16.594-39.562 4.946-6.563 11.24-12.07 18.72-15.97-3.124-42.547-68.335-81.236-191.627-81.217z"},child:[]}]})(t)}function i1(t){return M({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M323.9 19.81l-55.2 55.15L285 91.24 272.2 104 256 87.73 19.81 323.9l45.57 45.6c28.5-14.6 56.22-11.7 72.52 4.6 16.3 16.3 19.2 44 4.6 72.5l45.6 45.6 236.1-236.1-16.2-16.3 12.8-12.8 16.3 16.2 55.1-55.1-45.6-45.6c-28.5 14.6-56.2 11.7-72.5-4.6-16.3-16.3-19.2-44.02-4.6-72.52zm-16.2 93.99l33.9 34-12.8 12.8-33.9-34zM256 130.2L381.8 256 222.1 415.8 96.16 289.9 249.6 136.5zm0 25.4L121.6 289.9l100.5 100.5L356.4 256zm108.2 14.8l34 33.9-12.8 12.8-34-33.9z"},child:[]}]})(t)}function l1(t){return M({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 19m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v1a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z"},child:[]},{tag:"path",attr:{d:"M12 16c3.314 0 6 -4.686 6 -8a6 6 0 1 0 -12 0c0 3.314 2.686 8 6 8z"},child:[]},{tag:"path",attr:{d:"M12 9m-2 0a2 7 0 1 0 4 0a2 7 0 1 0 -4 0"},child:[]}]})(t)}const c1=t=>M({tag:"svg",attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"1",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"},child:[]}]})(t),s1={bs:{BsBrightnessAltHigh:$e,BsFillCarFrontFill:We,BsFuelPump:Ze,BsHouseExclamation:Ue,BsImage:Je},fa:{FaCampground:Ke,FaCity:Xe,FaMapMarker:Ye,FaTheaterMasks:qe,FaWineBottle:Qe},gi:{GiBunkBeds:t1,GiBus:e1,GiCruiser:n1,GiElephant:r1,GiHelicopter:o1,GiJourney:a1,GiTicket:i1},md:{MdFestival:me,MdHotel:ge,MdKayaking:ye,MdLocationCity:be,MdOutlineHiking:Ce,MdOutlinePark:Me,MdOutlineTour:ze,MdRestaurant:fe},tb:{TbAirBalloon:l1}},d1=(t,e="grey",n="grey")=>{var p;const[r,a]=t.split("/"),o=(p=s1[r])==null?void 0:p[a];return o?B.divIcon({html:`
    <div style="position: relative;">
      ${it(i(c1,{size:32,color:e}))}
      <div style="position: absolute; top: 45%; left: 65%; transform: translate(-50%, -50%);">
        ${it(i(o,{size:16,color:n}))}
      </div>
    </div>
  `,iconSize:[24,24],iconAnchor:[12,24],className:"custom-icon"}):(console.error(`Icon "${t}" not found in "${r}" set`),B.divIcon({html:"â“",className:"custom-icon"}))},p1=({feature:t,tabMapping:e})=>{var p;const[n,r]=w(0),a=(s,c)=>{r(c)},o=(p=t.properties)!=null&&p.images?t.properties.images.map(s=>{const c=typeof s=="string"?s:s.src,d=typeof s=="string"?"":s.title;return{original:c,thumbnail:c,originalTitle:d,thumbnailTitle:d}}):[];return C("div",{className:k.popupContent,children:[C("div",{className:k.tabsContainer,children:[i(gt,{value:n,onChange:a,children:Object.keys(e).map(s=>i(mt,{label:s},s))}),Object.entries(e).map(([s,c],d)=>i("div",{role:"tabpanel",hidden:n!==d,id:`tabpanel-${d}`,children:n===d&&i(A,{sx:{p:3},children:c.map(l=>{if(typeof l=="string"){const m=t.properties?t.properties[l]:"";return C(D,{variant:"subtitle1",children:[C("strong",{children:[l,":"]}),C("span",{children:[" ",m]})]},l)}const u=l.className||"",g=l.isHtml||!1;let h=t.properties?t.properties[l.key]:"";return typeof h=="object"&&h!==null&&(h=i("pre",{children:JSON.stringify(h,null,2)})),C("div",{style:{marginBottom:"8px"},children:[i(D,{variant:"subtitle1",children:C("strong",{children:[l.key,":"]})}),h&&!g&&i(D,{component:"div",className:u,children:h}),h&&g&&i(D,{component:"div",className:u,dangerouslySetInnerHTML:{__html:h}})]},l.key)})})},s))]}),o.length>0&&i("div",{style:{width:"450px"},children:i(qt,{items:o,showNav:!1,showPlayButton:!1})})]})},st=({data:t,popupTabMapping:e,popupTabMappingExtra:n,popupOpenHandler:r,contextMenuHandler:a,popupProps:o})=>{const p=z((u,g)=>{var y,b,x,O,H,_;const h=((b=(y=u.properties)==null?void 0:y.style)==null?void 0:b.icon)||"fa/FaMapMarker",m=((O=(x=u.properties)==null?void 0:x.style)==null?void 0:O.color)||"grey",f=((_=(H=u.properties)==null?void 0:H.style)==null?void 0:_.innerIconColor)||m,v=d1(h,m,f);return B.marker(g,{icon:v})},[]),s=T(()=>({General:["name","url",{key:"description",className:k.scrollableContent}]}),[]),c=z(({feature:u,layer:g,popupTabMapping:h})=>{const m=g.getPopup();if(m){const f=B.DomUtil.create("div");pt(f).render(i(p1,{feature:u,tabMapping:h})),m.setContent(f)}},[]),d=r||c,l=Object.assign({},e||s,n||{});return i(kt,{data:t,pointToLayer:p,onEachFeature:(u,g)=>{u.properties&&(u.properties.name&&g.bindTooltip(`${u.properties.name}`,{permanent:!1,direction:"auto"}),g.bindPopup("",{...o||{}}),g.on("popupopen",()=>{d({feature:u,layer:g,popupTabMapping:l})}),a&&g.on("contextmenu",h=>{a({event:h,feature:u})}))}})},h1="_contextMenu_j0zss_1",u1="_contextMenuItem_j0zss_10",zt={contextMenu:h1,contextMenuItem:u1},dt=({...t})=>{const e=n=>{n.stopPropagation(),t.payload&&t.handler(t.payload),t.closeMenu&&t.closeMenu()};return i("div",{className:zt.contextMenuItem,onClick:e,children:t.title})},m1=({position:t,onClose:e,children:n,payload:r={}})=>{const[a,o]=w(!!t);P(()=>{o(!!t)},[t]);const p=()=>{o(!1),e==null||e()};return a?i("div",{className:zt.contextMenu,style:{position:"absolute",left:t==null?void 0:t.x,top:t==null?void 0:t.y},children:L.Children.map(n,s=>L.cloneElement(s,{closeMenu:p,payload:r}))}):null},g1=({...t})=>{const[e,n]=w(null),[r,a]=w(null),o=Pt({contextmenu:s=>{s.originalEvent.preventDefault(),p(s.latlng)},click:()=>{setTimeout(()=>{n(null)},100)}}),p=z(s=>{const{lat:c,lng:d}=s;a({lat:c,lng:d});const l=o.latLngToContainerPoint(s);n({x:l.x,y:l.y})},[o]);return P(()=>{t.latlng?p(t.latlng):(a(null),n(null))},[t.latlng,p]),i(E,{children:e&&i(m1,{position:e,onClose:()=>n(null),payload:{coordinates:r},children:t.children})})},f1=({...t})=>{const{addFeature:e}=J(W),n=(a,o)=>{let p=o;if(!p){const s=prompt("Enter new name for feature"),c=a.coordinates,d=Qt();p={type:"Feature",properties:{id:d,name:s||`Location ${d}`},geometry:{type:"Point",coordinates:[c.lng,c.lat]}}}return p},r=(a,o)=>{const p=n(a,o);navigator.clipboard.writeText(JSON.stringify(p,null,2)).then(()=>{q.success("Copied feature to clipboard")}).catch(s=>{q.error(`Failed to copy feature to clipboard. ${s}`)})};return t.menuLatLng?C(g1,{latlng:t.menuLatLng,children:[i(dt,{title:"Copy feature to clipboard",handler:a=>{r(a,t.selectedFeature)}}),i(dt,{title:"Save feature to list",handler:a=>{e("all",n(a,t.selectedFeature))}})]}):null},v1=({geoJsonOverlaySources:t,...e})=>{const{savedFeatures:n}=J(W),[r,a]=w(null),[o,p]=w(null),[s,c]=w(!1),[d,l]=w([]),[u,g]=w([]),h=T(()=>Object.keys(t),[t]),m=De(h),f=z(({event:v,feature:y})=>{B.DomEvent.stopPropagation(v),a(v.latlng),p(y)},[]);return P(()=>{!m.loading&&!m.error&&l(Object.entries(t).map(([v,y])=>{var O;const b=m[v];return{name:(O=b==null?void 0:b.properties)==null?void 0:O.style.layerName,children:i(st,{data:b,popupTabMapping:y,contextMenuHandler:f,popupProps:{minWidth:900,maxHeight:500,keepInView:!0,autoPanPadding:B.point(160,500)}})}}))},[t,m,f]),P(()=>{g(Object.entries(n).map(([v,y])=>({name:`- ${v}`,children:i(st,{data:{type:"FeatureCollection",features:y,properties:{}},contextMenuHandler:f,popupProps:{minWidth:900,maxHeight:500,keepInView:!0},popupTabMappingExtra:{Notes:[{key:"tripNotes",className:k.scrollableContent,isHtml:!0}]}},Date.now())})))},[n,f]),C(E,{children:[i(ae,{overlays:[...d,...u],...e,children:i(f1,{selectedFeature:o,menuLatLng:r})}),i(Ve,{drawerOpen:s,onClose:()=>c(!s)})]})},y1=()=>{const t=T(()=>({lat:-31.953512,lng:115.857048}),[]),e=T(()=>({"./markers/westernAustralia/gas_stations_openstreetmap.json":{General:["name","brand","operator","opening_hours"]},"./markers/westernAustralia/gas_stations_fuelwatch.json":{General:["name","brandName","manned","operates247"]},"./markers/westernAustralia/gas_stations_bp.json":{General:["name","address",{key:"facilities",className:k.scrollableContent}],"More Info":[{key:"products",className:k.scrollableContent},"website","telephone"]},"./markers/westernAustralia/national_parks_simplified.json":{General:["name","url",{key:"description",className:k.scrollableContent}]},"./markers/westernAustralia/accommodation_WA.json":{General:["name","website","tarif","isBookable"],"More Info":["operatorName","GroupName","CheckInTime","CheckOutTime","email","address","hours"]},"./markers/westernAustralia/accommodation_campermate.json":{General:["name","fees","bookable",{key:"description",className:k.scrollableContent}],Score:["score","thumbs_up","thumbs_down"]},"./markers/westernAustralia/western_australia_tourism.json":{General:["name","url",{key:"description",className:k.scrollableContent}]},"./markers/westernAustralia/western_australia_visitor_centre.json":{General:["name","type",{key:"description",className:k.scrollableContent},{key:"pointOfDifference",className:k.scrollableContent}],Info:["address","hours","email","website"]},"./markers/westernAustralia/places.json":{General:["name"]}}),[]);return i(v1,{center:t,geoJsonOverlaySources:e})};function b1(){return i(E,{children:i(te,{children:i(y1,{})})})}pt(document.getElementById("root")).render(C(L.StrictMode,{children:[i(b1,{}),i(Ot,{})]}));
