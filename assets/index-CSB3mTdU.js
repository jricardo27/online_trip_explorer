import{jsx as i,jsxs as C,Fragment as _}from"react/jsx-runtime";import*as Ht from"react";import j,{useState as w,useCallback as z,useEffect as E,useRef as Lt,useContext as rt,useMemo as U}from"react";import{createRoot as bt}from"react-dom/client";import{toast as tt,ToastContainer as Pt}from"react-toastify";import{Menu as zt,MenuItem as B,ListItem as T,ListItemText as ot,ListItemIcon as It,IconButton as Mt,List as ct,Collapse as jt,Button as et,Tab as nt,Tabs as Ct,useTheme as at,useMediaQuery as A,Drawer as Et,Box as F,Typography as Z}from"@mui/material";import V from"leaflet";import{useMap as it,useMapEvent as Nt,MapContainer as _t,LayersControl as Y,TileLayer as Gt,GeoJSON as Vt,useMapEvents as Bt}from"react-leaflet";import{useSensors as At,useSensor as st,PointerSensor as Dt,KeyboardSensor as Tt,DndContext as Ft,pointerWithin as Rt,DragOverlay as Wt,useDroppable as $t}from"@dnd-kit/core";import{sortableKeyboardCoordinates as Zt,arrayMove as wt,useSortable as Ut}from"@dnd-kit/sortable";import{Editor as Jt}from"@tinymce/tinymce-react";import{CSS as Xt}from"@dnd-kit/utilities";import Kt from"@mui/material/Button";import Yt from"@mui/material/Fade";import qt from"@mui/material/Menu";import dt from"@mui/material/MenuItem";import ht from"file-saver";import Qt from"geojson-to-kml";import pt from"jszip";import te from"turndown";import ee from"axios";import{renderToString as ut}from"react-dom/server";import mt from"react-image-gallery";import{v4 as ne}from"uuid";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();const L=(t,e)=>{var n;return`${t}=${(n=e.properties)==null?void 0:n.id}`},R=t=>t?L(t.index,t.feature):"",K=j.createContext(void 0),q="savedFeatures",re=({children:t})=>{const[e,n]=w(()=>{const c=localStorage.getItem(q);return c?JSON.parse(c):{all:[]}}),r=z(()=>{localStorage.setItem(q,JSON.stringify(e))},[e]),o=z(()=>{const c=localStorage.getItem(q);c&&n(JSON.parse(c))},[]);E(()=>{r()},[e,r]);const a=z(c=>{n(typeof c=="function"?v=>c(v):c)},[n]),s=z((c,v)=>{a(f=>{const h=[...f[c]||[],v];return c==="all"?{...f,[c]:h}:{...f,[c]:h,all:f.all.filter(m=>{var g,p;return((g=m.properties)==null?void 0:g.id)!==((p=v.properties)==null?void 0:p.id)})}})},[a]),u=z((c,v)=>{if(!v){console.error("No selection info when trying to remove feature");return}a(f=>{const h=(f[c]||[]).filter((m,g)=>L(g,m)!==R(v));return{...f,[c]:h}})},[a]),l=z((c,v)=>{a(f=>{const h={...f};for(const m in h)h[m]=h[m].map(g=>{var p,y;return((p=g.properties)==null?void 0:p.id)===((y=c.properties)==null?void 0:y.id)?v:g});return h})},[a]),d={savedFeatures:e,addFeature:s,removeFeature:u,updateFeature:l,setSavedFeatures:a,saveToLocalStorage:r,loadFromLocalStorage:o};return i(K.Provider,{value:d,children:t})};var xt={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},gt=j.createContext&&j.createContext(xt),oe=["attr","size","title"];function ae(t,e){if(t==null)return{};var n=ie(t,e),r,o;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(o=0;o<a.length;o++)r=a[o],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function ie(t,e){if(t==null)return{};var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;n[r]=t[r]}return n}function J(){return J=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},J.apply(this,arguments)}function ft(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,r)}return n}function X(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ft(Object(n),!0).forEach(function(r){le(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ft(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function le(t,e,n){return e=ce(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ce(t){var e=se(t,"string");return typeof e=="symbol"?e:e+""}function se(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function St(t){return t&&t.map((e,n)=>j.createElement(e.tag,X({key:n},e.attr),St(e.child)))}function M(t){return e=>j.createElement(de,J({attr:X({},t.attr)},e),St(t.child))}function de(t){var e=n=>{var{attr:r,size:o,title:a}=t,s=ae(t,oe),u=o||n.size||"1em",l;return n.className&&(l=n.className),t.className&&(l=(l?l+" ":"")+t.className),j.createElement("svg",J({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,r,s,{className:l,style:X(X({color:t.color||n.color},n.style),t.style),height:u,width:u,xmlns:"http://www.w3.org/2000/svg"}),a&&j.createElement("title",null,a),t.children)};return gt!==void 0?j.createElement(gt.Consumer,null,n=>e(n)):e(xt)}function he(t){return M({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M18 13c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zm3 5.5h-2.5V21h-1v-2.5H15v-1h2.5V15h1v2.5H21v1z"},child:[]},{tag:"path",attr:{d:"M11.69 15c.36-.75.84-1.43 1.43-2H7v-2h11c1.07 0 2.09.25 3 .69V5c0-1.1-.9-2-2-2h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h6.69c-.44-.91-.69-1.93-.69-3 0-.34.03-.67.08-1H7v-2h4.69zM12 2.75c.41 0 .75.34.75.75s-.34.75-.75.75-.75-.34-.75-.75.34-.75.75-.75zM7 7h10v2H7V7z"},child:[]}]})(t)}function pe(t){return M({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M11 18c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zm-2-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 4c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"},child:[]}]})(t)}function ue(t){return M({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M13 5.7V4h3l-1-1.49L16 1h-5v4.7L2 12v10h7v-5l3.03-2L15 17v5h7V12z"},child:[]}]})(t)}function me(t){return M({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M7 13c1.66 0 3-1.34 3-3S8.66 7 7 7s-3 1.34-3 3 1.34 3 3 3zm12-6h-8v7H3V5H1v15h2v-3h18v3h2v-9c0-2.21-1.79-4-4-4z"},child:[]}]})(t)}function ge(t){return M({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M11 9H9V2H7v7H5V2H3v7c0 2.12 1.66 3.84 3.75 3.97V22h2.5v-9.03C11.34 12.84 13 11.12 13 9V2h-2v7zm5-3v8h2.5v8H21V2c-2.76 0-5 2.24-5 4z"},child:[]}]})(t)}function fe(t){return M({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"},child:[]}]})(t)}function ve(t){return M({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M21 23c-1.03 0-2.06-.25-3-.75-1.89 1-4.11 1-6 0-1.89 1-4.11 1-6 0-.95.5-1.97.75-3 .75H2v-2h1c1.04 0 2.08-.35 3-1 1.83 1.3 4.17 1.3 6 0 1.83 1.3 4.17 1.3 6 0 .91.65 1.96 1 3 1h1v2h-1zM12 5.5c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 12s-1.52.71-3.93 1.37c-.82-.23-1.53-.75-2.07-1.37-.73.84-1.8 1.5-3 1.5s-2.27-.66-3-1.5c-.73.84-1.8 1.5-3 1.5s-2.27-.66-3-1.5c-.54.61-1.25 1.13-2.07 1.37C1.52 18.21 0 17.5 0 17.5s2.93-1.36 7.13-2.08l1.35-4.17c.31-.95 1.32-1.47 2.27-1.16.09.03.19.07.27.11l2.47 1.3 2.84-1.5 1.65-3.71-.51-1.32L18.8 2 22 3.43 20.67 6.4l-1.31.5-3.72 8.34c4.85.63 8.36 2.26 8.36 2.26zm-8.98-4.54-1.52.8-1.75-.92-.71 2.17c.32 0 .64-.01.96-.01.71 0 1.4.03 2.07.08l.95-2.12z"},child:[]}]})(t)}function ye(t){return M({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M15 11V5l-3-3-3 3v2H3v14h18V11h-6zm-8 8H5v-2h2v2zm0-4H5v-2h2v2zm0-4H5V9h2v2zm6 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V9h2v2zm0-4h-2V5h2v2zm6 12h-2v-2h2v2zm0-4h-2v-2h2v2z"},child:[]}]})(t)}function be(t){return M({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M21 4H7V2H5v20h2v-8h14l-2-5 2-5zm-3.86 5.74.9 2.26H7V6h11.05l-.9 2.26-.3.74.29.74zM14 9c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2z"},child:[]}]})(t)}function ze(t){return M({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M17 12h2L12 2 5.05 12H7l-3.9 6h6.92v4h3.95v-4H21l-4-6zM6.79 16l3.9-6H8.88l3.13-4.5 3.15 4.5h-1.9l4 6H6.79z"},child:[]}]})(t)}function Me(t){return M({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M13.5 5.5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm4 5.28c-1.23-.37-2.22-1.17-2.8-2.18l-1-1.6c-.41-.65-1.11-1-1.84-1-.78 0-1.59.5-1.78 1.44S7 23 7 23h2.1l1.8-8 2.1 2v6h2v-7.5l-2.1-2 .6-3c1 1.15 2.41 2.01 4 2.34V23H19V9h-1.5v1.78zM7.43 13.13l-2.12-.41a.999.999 0 0 1-.79-1.17l.76-3.93a2 2 0 0 1 2.34-1.58l1.16.23-1.35 6.86z"},child:[]}]})(t)}const Ce={osm:{name:"OpenStreetMap",maxZoom:19,url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},CyclOSM:{name:"CyclOSM",maxZoom:20,url:"https://{s}.tile-cyclosm.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors. Tiles courtesy of <a href="https://www.openstreetmap.fr" target="_blank">OpenStreetMap France</a>'},esriWorldImagery:{name:"Esri World Imagery",maxZoom:20,url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"},esriWorldStreetMap:{name:"Esri World Street Map",maxZoom:20,url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"},esriWorldTopoMap:{name:"Esri World Topographic Map",maxZoom:20,url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"}},we=()=>{const t=it();return Nt("moveend",()=>{const e=t.getCenter(),n=t.getZoom(),r={center:[e.lat,e.lng],zoom:n};localStorage.setItem("mapState",JSON.stringify(r))}),null},xe=({center:t,zoom:e})=>{const n=it();return E(()=>{t&&e&&n.setView(t,e)},[t,e,n]),null};function Se(){const t=it(),[e,n]=w(t.getZoom()),r={background:"white",bottom:"10px",color:"black",left:"10px",padding:"5px",position:"absolute",zIndex:400};return E(()=>{const o=()=>{n(t.getZoom())};return t.on("zoomend",o),()=>{t.off("zoomend",o)}},[t]),C("div",{style:r,children:["Zoom: ",e]})}const Oe=({children:t,center:e,overlays:n})=>{const r=Lt(null),[o]=w("esriWorldStreetMap"),[a,s]=w({center:e,zoom:13}),u=z(()=>{const l=localStorage.getItem("mapState");l&&s(JSON.parse(l))},[]);return E(()=>{u()},[u]),i(_,{children:C(_t,{center:a.center,zoom:a.zoom,ref:r,scrollWheelZoom:!0,style:{height:"100vh",width:"100%"},children:[i(we,{}),i(xe,{center:a.center,zoom:a.zoom}),i(Se,{}),C(Y,{position:"topright",children:[Object.entries(Ce).map(([l,d])=>i(Y.BaseLayer,{name:d.name,checked:o===l,children:i(Gt,{attribution:d.attribution,url:d.url,maxZoom:d.maxZoom||20})},l)),n&&n.map(l=>i(Y.Overlay,{name:l.name,checked:l.checked,children:l.children},l.name))]}),t]})})},ke=({contextMenu:t,contextMenuTab:e,handleClose:n,moveCategory:r,handleRenameCategory:o,handleAddCategory:a,handleRemoveCategory:s})=>{const u=z(()=>{if(!e)return;const d=prompt("Enter new name for category",e);d&&d!==e&&o(d)},[e,o]),l=d=>c=>{d(c),n()};return e?C(zt,{open:t!==null,onClose:n,anchorReference:"anchorPosition",anchorPosition:t!==null?{top:t.mouseY,left:t.mouseX}:void 0,children:[e&&e!=="all"?C(_,{children:[i(B,{onClick:l(()=>r("up")),children:"Move Up"}),i(B,{onClick:l(()=>r("down")),children:"Move Down"}),i(B,{onClick:l(u),children:"Rename Category"}),i(B,{onClick:l(s),children:"Remove Category"})]}):null,i(B,{onClick:l(a),children:"Add New Category"})]}):i(_,{})},He=({contextMenu:t,contextMenuFeature:e,handleClose:n,handleDuplicate:r,handleRemoveFromList:o,handleRemoveCompletely:a})=>{if(!e)return i(_,{});const s=u=>l=>{u(l),n()};return i(zt,{open:t!==null,onClose:n,anchorReference:"anchorPosition",anchorPosition:t!==null?{top:t.mouseY,left:t.mouseX}:void 0,children:e&&C(_,{children:[i(B,{onClick:s(r),children:"Duplicate"}),e.category!="all"&&i(B,{onClick:s(o),children:"Remove from this list"}),i(B,{onClick:s(a),children:"Remove"})]})})},Le=({children:t,savedFeatures:e,selectedTab:n,setSavedFeatures:r})=>{var c,v;const[o,a]=w(null),s=At(st(Dt),st(Tt,{coordinateGetter:Zt})),u=z(f=>{a(f.active.id.toString())},[]),l=z(f=>{var g,p;const{active:h,over:m}=f;if(m&&h.id!==m.id){const y=e[n].find((b,x)=>L(x,b)===h.id);if(y){const b=n;let x=n;if(((p=(g=m.data)==null?void 0:g.current)==null?void 0:p.type)==="tab"&&(x=m.id.toString()),b!==x)r(S=>{const O={...S};return O[b]=O[b].filter((H,k)=>L(k,H)!==h.id),O[x]=[...O[x],y],O});else{const S=e[b].findIndex((k,P)=>L(P,k)===h.id),O=e[b].findIndex((k,P)=>L(P,k)===m.id),H=wt(e[b],S,O);r(k=>({...k,[b]:H}))}}}a(null)},[e,n,r]),d=z(()=>{a(null)},[]);return C(Ft,{sensors:s,collisionDetection:Rt,onDragStart:u,onDragEnd:l,onDragCancel:d,children:[t,i(Wt,{children:o?i(T,{children:i(ot,{primary:((v=(c=e[n].find((f,h)=>L(h,f)===o))==null?void 0:c.properties)==null?void 0:v.name)||"Unnamed Feature"})}):null})]})},Pe={"tinymce-editor":"_tinymce-editor_10zer_1"},Ie=({initialText:t,onChange:e})=>{const[n,r]=w(t),o=a=>{typeof a=="string"&&(r(a),e(a))};return i("div",{className:Pe["tinymce-editor"],children:i(Jt,{onChange:o,init:{height:400,width:"100%",menubar:!1,plugins:["lists","advlist","fullscreen","autolink","charmap","code","image","link","table"],toolbar:["undo redo bold italic backcolor image charmap link | advlist bullist numlist outdent indent table | code  fullscreen"],skin_url:"./tinymce/skins/ui/oxide"},value:n,onEditorChange:o,licenseKey:"gpl"})})},je=({feature:t,id:e,index:n,selectedTab:r,selectedFeature:o,setSelectedFeature:a,handleContextMenu:s})=>{var p;const{attributes:u,listeners:l,setNodeRef:d,transform:c,transition:v,isDragging:f}=Ut({id:e}),h={transform:Xt.Transform.toString(c),transition:v,opacity:f?.5:1,border:f?"dashed":""},m=R(o)===L(n,t),g={feature:t,index:n,category:r};return C(T,{ref:d,style:h,onClick:y=>{y.stopPropagation(),a(m?null:g)},onContextMenu:y=>{s(y,g),y.stopPropagation()},button:"true",children:[i(It,{children:i(Mt,{edge:"start","aria-label":"drag",...l,...u,sx:{cursor:"grab","&:active":{cursor:"grabbing"}},children:i(pe,{})})}),i(ot,{primary:((p=t.properties)==null?void 0:p.name)||"Unnamed Feature"})]})},Ee=({features:t,setSavedFeatures:e,selectedTab:n,selectedFeature:r,setSelectedFeature:o,handleContextMenu:a,excludedProperties:s})=>{const[u,l]=w(!1),[d,c]=w(""),v=m=>{var g;u?(l(!1),c("")):(c(((g=m.properties)==null?void 0:g.tripNotes)||""),l(!0))},f=m=>{c(m)},h=()=>{r&&e(m=>{const g=[...m[n]],p=g.findIndex((y,b)=>L(b,y)===R(r));return p!==-1&&g[p].properties&&(g[p].properties.tripNotes=d),{...m,[n]:g}})};return E(()=>{!r&&u&&(l(!1),c(""))},[u,r,c,l]),i(ct,{children:t.map((m,g)=>C(j.Fragment,{children:[i(je,{feature:m,id:L(g,m),index:g,selectedTab:n,selectedFeature:r,setSelectedFeature:o,handleContextMenu:a}),C(jt,{in:R(r)===L(g,m),timeout:"auto",unmountOnExit:!0,children:[i(T,{sx:{pl:4},children:i(et,{onClick:()=>v(m),children:"Add/edit notes"})}),u&&C(_,{children:[i(T,{sx:{pl:4},children:i(Ie,{initialText:d,onChange:f},L(g,m))}),i(T,{sx:{pl:4},children:i(et,{onClick:h,children:"Save notes"})})]}),i(ct,{component:"div",disablePadding:!0,children:Object.entries(m.properties||{}).filter(([p])=>!s.includes(p)).map(([p,y])=>i(T,{sx:{pl:4},children:i(ot,{primary:`${p}: ${y}`})},p))})]})]},L(g,m)))})},Ne=({tab:t,onContextMenu:e,value:n,...r})=>{const{setNodeRef:o,node:a}=$t({id:t,data:{category:t,type:"tab"}});return i(nt,{ref:o,label:t,value:n,onContextMenu:e,sx:{border:a!=null&&a.rect?"1px dashed #ccc":"none"},...r})},_e=({tabs:t,selectedTab:e,handleTabChange:n,handleTabContextMenu:r})=>i(Ct,{orientation:"vertical",variant:"scrollable",value:e,onChange:n,"aria-label":"Saved Features Tabs",sx:{height:"100%"},children:t.map(o=>i(Ne,{tab:o,value:o,onContextMenu:a=>r(a,o)},o))}),Ge=t=>{var n,r,o,a,s;const e={...t};if(e.properties||(e.properties={}),(n=t.properties)!=null&&n.tripNotes){const l=new te().turndown(t.properties.tripNotes);l&&(e.properties.description=l+`

--------------------

`+e.properties.description)}return(r=e.properties)==null||delete r.id,(o=e.properties)==null||delete o.style,(a=e.properties)==null||delete a.images,(s=e.properties)==null||delete s.tripNotes,e},Ve=({savedFeatures:t})=>{const[e,n]=Ht.useState(null),r=!!e,o=d=>{n(d.currentTarget)},a=()=>{n(null)},s=d=>c=>{d(c),a()},u=z(()=>{const d=new pt;Object.entries(t).map(([c,v])=>{const f={type:"FeatureCollection",features:v};d.file(`${c}.geojson`,JSON.stringify(f))}),d.generateAsync({type:"blob"}).then(c=>{ht.saveAs(c,"trip_explorer_features.json.zip")})},[t]),l=z(()=>{const d=new pt;Object.entries(t).map(([c,v])=>{const f={type:"FeatureCollection",features:v.map(m=>Ge(m))},h=Qt(f);d.file(`${c}.kml`,h)}),d.generateAsync({type:"blob"}).then(c=>{ht.saveAs(c,"trip_explorer_features.kml.zip")})},[t]);return C("div",{children:[i(Kt,{id:"fade-button","aria-controls":r?"fade-menu":void 0,"aria-haspopup":"true","aria-expanded":r?"true":void 0,onClick:o,children:"Export"}),C(qt,{id:"fade-menu",MenuListProps:{"aria-labelledby":"fade-button"},anchorEl:e,open:r,onClose:a,TransitionComponent:Yt,children:[i(dt,{onClick:s(u),children:"To GeoJson"}),i(dt,{onClick:s(l),children:"To KML"})]})]})},Be=(t,e,n,r)=>{const o=z(l=>{if(!r||r==="all")return;const d=Object.keys(n),c=d.indexOf(r);if(c===-1)return;let v;if(l==="up"&&c>1)v=c-1;else if(l==="down"&&c<d.length-1)v=c+1;else return;const f=wt(d,c,v),h=Object.fromEntries(f.map(m=>[m,n[m]]));t(h)},[r,n,t]),a=z(l=>{r&&r!=="all"&&l!=="all"&&t(d=>{const c={...d};c[l]=c[r],delete c[r];const v=Object.keys(c),f=v.indexOf(r);return f!==-1&&v.splice(f,1,l),Object.fromEntries(v.map(h=>[h,c[h]]))})},[r,t]),s=z(()=>{let l=prompt("Enter name for category");(!l||Object.keys(n).includes(l))&&(l=`Category_${Object.keys(n).length}`),t(d=>({...d,[l]:[]}))},[n,t]),u=z(()=>{if(r&&r!=="all"){t(v=>{const f=v[r],h={...v};return delete h[r],h.all=[...h.all,...f],h});const l=Object.keys(n),d=l.indexOf(r),c=l[d-1];e(c)}},[r,t,e,n]);return{moveCategory:o,handleRenameCategory:a,handleAddCategory:s,handleRemoveCategory:u}},Ae=()=>{const[t,e]=w(null),[n,r]=w(null),[o,a]=w(null),s=z((d,c,v)=>{d.preventDefault(),e({mouseX:d.clientX+2,mouseY:d.clientY-6}),a(c||null),r(v||null)},[]),u=z((d,c)=>{s(d,void 0,c)},[s]),l=z(()=>{e(null),r(null),a(null)},[]);return{contextMenu:t,contextMenuTab:n,contextMenuFeature:o,handleContextMenu:s,handleTabContextMenu:u,handleClose:l}},De=(t,e,n,r)=>{const o=z(()=>{n&&t(u=>({...u,[e]:[...u[e],n.feature]}))},[n,e,t]),a=z(()=>{n&&e!=="all"&&(r(e,n),t(u=>({...u,all:[...u.all,n.feature]})))},[n,e,r,t]),s=z(()=>{n&&(r(e,n),t(u=>({...u,all:u.all.filter((l,d)=>L(d,l)!==R(n))})))},[n,e,r,t]);return{handleDuplicate:o,handleRemoveFromList:a,handleRemoveCompletely:s}},Te=()=>{const[t,e]=w(null),n=z(r=>{e(o=>o===r?null:r)},[]);return{selectedFeature:t,setSelectedFeature:n}},Fe=["id","images","style"],Re=({drawerOpen:t,onClose:e,setCurrentCategory:n})=>{const[r,o]=w("all"),{savedFeatures:a,setSavedFeatures:s,removeFeature:u}=rt(K),{selectedFeature:l,setSelectedFeature:d}=Te(),{contextMenu:c,contextMenuTab:v,contextMenuFeature:f,handleContextMenu:h,handleTabContextMenu:m,handleClose:g}=Ae(),{moveCategory:p,handleRenameCategory:y,handleAddCategory:b,handleRemoveCategory:x}=Be(s,o,a,v),{handleDuplicate:S,handleRemoveFromList:O,handleRemoveCompletely:H}=De(s,r,f,u),k=at(),P=A(k.breakpoints.down("sm")),W=A(k.breakpoints.between("sm","md")),N=A(k.breakpoints.between("md","lg"))?"70%":W?"50%":P?"92%":"50%",D=z((lt,$)=>{o($),d(null)},[d]);return E(()=>{n&&n(r)},[r,n]),C(_,{children:[i(Mt,{onClick:e,style:{position:"absolute",top:10,left:40,zIndex:1e3},children:i(fe,{})}),C(Le,{savedFeatures:a,selectedTab:r,setSavedFeatures:s,children:[C(Et,{anchor:"left",open:t,onClose:e,sx:{width:N,flexShrink:0,"& .MuiDrawer-paper":{width:N,boxSizing:"border-box"}},children:[i(F,{sx:{display:"flex",height:"50px",border:"1px solid #ccc"},children:i(Ve,{savedFeatures:a})}),C(F,{sx:{display:"flex",height:"100%"},children:[i(F,{sx:{width:150,bgcolor:"background.paper",borderRight:1,borderColor:"divider"},children:i(_e,{tabs:Object.keys(a),selectedTab:r,handleTabChange:D,handleTabContextMenu:m})}),i(F,{sx:{flexGrow:1,overflowY:"auto"},children:i(Ee,{features:a[r]||[],setSavedFeatures:s,selectedTab:r,selectedFeature:l,setSelectedFeature:d,handleContextMenu:h,excludedProperties:Array.from(Fe)})})]})]}),i(ke,{contextMenu:c,contextMenuTab:v,handleClose:g,moveCategory:p,handleRenameCategory:y,handleAddCategory:b,handleRemoveCategory:x}),i(He,{contextMenu:c,contextMenuFeature:f,handleClose:g,handleDuplicate:S,handleRemoveFromList:O,handleRemoveCompletely:H})]})]})};function Ot(t,e){const n={...t};return Q(t)&&Q(e)&&Object.keys(e).forEach(r=>{Q(e[r])?r in t?n[r]=Ot(t[r],e[r]):Object.assign(n,{[r]:e[r]}):Object.assign(n,{[r]:e[r]})}),n}function Q(t){return t&&typeof t=="object"&&!Array.isArray(t)}const We=t=>{const[e,n]=w({}),[r,o]=w(!0),[a,s]=w(null);return E(()=>{(async()=>{o(!0);try{const l={},c=t.map(async h=>{const m=await ee.get(h,l);return[h,m.data]}),f=(await Promise.all(c)).reduce((h,[m,g])=>{const p=g.properties||{};return g.features.forEach(y=>{if(y.type!=="Feature"){console.warn("Skipping non-feature item in features array");return}y.properties={...p,...y.properties},Object.keys(p).forEach(b=>{var x;if(typeof p[b]=="object"&&p[b]!==null){const S=(x=y.properties)==null?void 0:x[b];typeof S=="object"&&S!==null?y.properties[b]=Ot(p[b],S):y.properties[b]=p[b]}})}),h[m]=g,h},{});n(f)}catch(l){l instanceof Error&&s(l.message)}finally{o(!1)}})()},[t]),r?{...e,loading:!0}:a?(console.error(a),{...e,error:a}):e},$e="_scrollableContent_z5154_1",Ze="_tabsContainer_z5154_10",G={scrollableContent:$e,tabsContainer:Ze};function Ue(t){return M({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M2.52 3.515A2.5 2.5 0 0 1 4.82 2h6.362c1 0 1.904.596 2.298 1.515l.792 1.848c.075.175.21.319.38.404.5.25.855.715.965 1.262l.335 1.679q.05.242.049.49v.413c0 .814-.39 1.543-1 1.997V13.5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-1.338c-1.292.048-2.745.088-4 .088s-2.708-.04-4-.088V13.5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-1.892c-.61-.454-1-1.183-1-1.997v-.413a2.5 2.5 0 0 1 .049-.49l.335-1.68c.11-.546.465-1.012.964-1.261a.8.8 0 0 0 .381-.404l.792-1.848ZM3 10a1 1 0 1 0 0-2 1 1 0 0 0 0 2m10 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6 8a1 1 0 0 0 0 2h4a1 1 0 1 0 0-2zM2.906 5.189a.51.51 0 0 0 .497.731c.91-.073 3.35-.17 4.597-.17s3.688.097 4.597.17a.51.51 0 0 0 .497-.731l-.956-1.913A.5.5 0 0 0 11.691 3H4.309a.5.5 0 0 0-.447.276L2.906 5.19Z"},child:[]}]})(t)}function Je(t){return M({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M8 3a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 3m8 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5m-13.5.5a.5.5 0 0 0 0-1h-2a.5.5 0 0 0 0 1zm11.157-6.157a.5.5 0 0 1 0 .707l-1.414 1.414a.5.5 0 1 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0m-9.9 2.121a.5.5 0 0 0 .707-.707L3.05 5.343a.5.5 0 1 0-.707.707zM8 7a4 4 0 0 0-4 4 .5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5 4 4 0 0 0-4-4m0 1a3 3 0 0 1 2.959 2.5H5.04A3 3 0 0 1 8 8"},child:[]}]})(t)}function Xe(t){return M({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M3 2.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 .5.5v5a.5.5 0 0 1-.5.5h-5a.5.5 0 0 1-.5-.5z"},child:[]},{tag:"path",attr:{d:"M1 2a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v8a2 2 0 0 1 2 2v.5a.5.5 0 0 0 1 0V8h-.5a.5.5 0 0 1-.5-.5V4.375a.5.5 0 0 1 .5-.5h1.495c-.011-.476-.053-.894-.201-1.222a.97.97 0 0 0-.394-.458c-.184-.11-.464-.195-.9-.195a.5.5 0 0 1 0-1q.846-.002 1.412.336c.383.228.634.551.794.907.295.655.294 1.465.294 2.081v3.175a.5.5 0 0 1-.5.501H15v4.5a1.5 1.5 0 0 1-3 0V12a1 1 0 0 0-1-1v4h.5a.5.5 0 0 1 0 1H.5a.5.5 0 0 1 0-1H1zm9 0a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v13h8z"},child:[]}]})(t)}function Ke(t){return M({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M7.293 1.5a1 1 0 0 1 1.414 0L11 3.793V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v3.293l2.354 2.353a.5.5 0 0 1-.708.708L8 2.207l-5 5V13.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 1 0 1h-4A1.5 1.5 0 0 1 2 13.5V8.207l-.646.647a.5.5 0 1 1-.708-.708z"},child:[]},{tag:"path",attr:{d:"M16 12.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0m-3.5-2a.5.5 0 0 0-.5.5v1.5a.5.5 0 1 0 1 0V11a.5.5 0 0 0-.5-.5m0 4a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1"},child:[]}]})(t)}function Ye(t){return M({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"},child:[]},{tag:"path",attr:{d:"M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1z"},child:[]}]})(t)}function qe(t){return M({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 448h-24.68L359.54 117.75l53.41-73.55c5.19-7.15 3.61-17.16-3.54-22.35l-25.9-18.79c-7.15-5.19-17.15-3.61-22.35 3.55L320 63.3 278.83 6.6c-5.19-7.15-15.2-8.74-22.35-3.55l-25.88 18.8c-7.15 5.19-8.74 15.2-3.54 22.35l53.41 73.55L40.68 448H16c-8.84 0-16 7.16-16 16v32c0 8.84 7.16 16 16 16h608c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16zM320 288l116.36 160H203.64L320 288z"},child:[]}]})(t)}function Qe(t){return M({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M616 192H480V24c0-13.26-10.74-24-24-24H312c-13.26 0-24 10.74-24 24v72h-64V16c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v80h-64V16c0-8.84-7.16-16-16-16H80c-8.84 0-16 7.16-16 16v80H24c-13.26 0-24 10.74-24 24v360c0 17.67 14.33 32 32 32h576c17.67 0 32-14.33 32-32V216c0-13.26-10.75-24-24-24zM128 404c0 6.63-5.37 12-12 12H76c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm0-96c0 6.63-5.37 12-12 12H76c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm0-96c0 6.63-5.37 12-12 12H76c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm128 192c0 6.63-5.37 12-12 12h-40c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm0-96c0 6.63-5.37 12-12 12h-40c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm0-96c0 6.63-5.37 12-12 12h-40c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm160 96c0 6.63-5.37 12-12 12h-40c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm0-96c0 6.63-5.37 12-12 12h-40c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm0-96c0 6.63-5.37 12-12 12h-40c-6.63 0-12-5.37-12-12V76c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm160 288c0 6.63-5.37 12-12 12h-40c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm0-96c0 6.63-5.37 12-12 12h-40c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40z"},child:[]}]})(t)}function t1(t){return M({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M172.268 501.67C26.97 291.031 0 269.413 0 192 0 85.961 85.961 0 192 0s192 85.961 192 192c0 77.413-26.97 99.031-172.268 309.67-9.535 13.774-29.93 13.773-39.464 0z"},child:[]}]})(t)}function e1(t){return M({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M206.86 245.15c-35.88 10.45-59.95 41.2-57.53 74.1 11.4-12.72 28.81-23.7 49.9-30.92l7.63-43.18zM95.81 295L64.08 115.49c-.29-1.62.28-2.62.24-2.65 57.76-32.06 123.12-49.01 189.01-49.01 1.61 0 3.23.17 4.85.19 13.95-13.47 31.73-22.83 51.59-26 18.89-3.02 38.05-4.55 57.18-5.32-9.99-13.95-24.48-24.23-41.77-27C301.27 1.89 277.24 0 253.32 0 176.66 0 101.02 19.42 33.2 57.06 9.03 70.48-3.92 98.48 1.05 126.58l31.73 179.51c14.23 80.52 136.33 142.08 204.45 142.08 3.59 0 6.75-.46 10.01-.8-13.52-17.08-28.94-40.48-39.5-67.58-47.61-12.98-106.06-51.62-111.93-84.79zm97.55-137.46c-.73-4.12-2.23-7.87-4.07-11.4-8.25 8.91-20.67 15.75-35.32 18.32-14.65 2.58-28.67.4-39.48-5.17-.52 3.94-.64 7.98.09 12.1 3.84 21.7 24.58 36.19 46.34 32.37 21.75-3.82 36.28-24.52 32.44-46.22zM606.8 120.9c-88.98-49.38-191.43-67.41-291.98-51.35-27.31 4.36-49.08 26.26-54.04 54.36l-31.73 179.51c-15.39 87.05 95.28 196.27 158.31 207.35 63.03 11.09 204.47-53.79 219.86-140.84l31.73-179.51c4.97-28.11-7.98-56.11-32.15-69.52zm-273.24 96.8c3.84-21.7 24.58-36.19 46.34-32.36 21.76 3.83 36.28 24.52 32.45 46.22-.73 4.12-2.23 7.87-4.07 11.4-8.25-8.91-20.67-15.75-35.32-18.32-14.65-2.58-28.67-.4-39.48 5.17-.53-3.95-.65-7.99.08-12.11zm70.47 198.76c-55.68-9.79-93.52-59.27-89.04-112.9 20.6 25.54 56.21 46.17 99.49 53.78 43.28 7.61 83.82.37 111.93-16.6-14.18 51.94-66.71 85.51-122.38 75.72zm130.3-151.34c-8.25-8.91-20.68-15.75-35.33-18.32-14.65-2.58-28.67-.4-39.48 5.17-.52-3.94-.64-7.98.09-12.1 3.84-21.7 24.58-36.19 46.34-32.37 21.75 3.83 36.28 24.52 32.45 46.22-.73 4.13-2.23 7.88-4.07 11.4z"},child:[]}]})(t)}function n1(t){return M({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M507.31 72.57L439.43 4.69c-6.25-6.25-16.38-6.25-22.63 0l-22.63 22.63c-6.25 6.25-6.25 16.38 0 22.63l-76.67 76.67c-46.58-19.7-102.4-10.73-140.37 27.23L18.75 312.23c-24.99 24.99-24.99 65.52 0 90.51l90.51 90.51c24.99 24.99 65.52 24.99 90.51 0l158.39-158.39c37.96-37.96 46.93-93.79 27.23-140.37l76.67-76.67c6.25 6.25 16.38 6.25 22.63 0l22.63-22.63c6.24-6.24 6.24-16.37-.01-22.62zM179.22 423.29l-90.51-90.51 122.04-122.04 90.51 90.51-122.04 122.04z"},child:[]}]})(t)}function r1(t){return M({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M25 41v446h30V41zm56.8 40.15c-.1 14.49 1.03 25.35 3.31 32.75 2.77 8.9 6.33 12.9 12.45 16 11.34 5.7 35.34 5.3 70.54 5.1.8-8.5-.5-15.1-3.2-20.4-3.5-6.8-9.4-12.2-18.1-16.86-15.4-8.19-39.1-12.83-65-16.59zM457 105v382h30V105zM73 153v46h238v-46zm256 0v46h110v-46zm-18 64v158h18v-46h110v-18H329v-46h110v-18H329v-30zM81.79 321.3c-.1 14.4 1.03 25.3 3.3 32.6 2.78 9 6.33 13 12.46 16 11.35 5.7 35.35 5.3 70.55 5.1.8-8.5-.5-15-3.2-20.3-3.4-6.8-9.4-12.2-18.1-16.8-15.4-8.2-39.1-12.8-65.01-16.6zM73 393v46h238v-46zm256 0v46h110v-46z"},child:[]}]})(t)}function o1(t){return M({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M47 145c-10 0-23 12.4-23 24.9v134.3l52.49 7.5C84.97 297 100.9 287 119 287c21 0 39 13.3 45.9 32h188.2c6.9-18.7 24.9-32 45.9-32s39 13.3 45.9 32H488v-77.2L456.5 145zm-9 14h405.6l25.6 82H296v64h-98v-64H38zm18 18v46h62v-46zm80 0v46h62v-46zm80 0v110h22V177zm40 0v110h22V177zm40 0v46h62v-46zm86.6 0v46h62.2l-14.4-46zM119 305c-17.2 0-31 13.8-31 31s13.8 31 31 31 31-13.8 31-31-13.8-31-31-31zm280 0c-17.2 0-31 13.8-31 31s13.8 31 31 31 31-13.8 31-31-13.8-31-31-31zm-280 23a8 8 0 0 1 8 8 8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8zm280 0a8 8 0 0 1 8 8 8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8z"},child:[]}]})(t)}function a1(t){return M({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M247 80v53h-26v48h-34.027l-2.54 18.154-38.408-3.205-2.05 18.102 37.988 2.994-4.578 34.312-25.592 13.96 22.006 65.107a1658.637 1658.637 0 0 0-137.914 15.91l2.812 17.777a1639.075 1639.075 0 0 1 121.096-14.529l-.078.31c112.547 28.156 190.551 43.088 306.816-8.958l-7.355-16.43a485.085 485.085 0 0 1-26.844 11.092c-29.894-4.015-61.118-6.653-93.156-8.053l21.031-62.227-25.592-13.959L325.027 181H291v-48h-26V80h-18zm-8 71h34v30h-34v-30zm-35.973 48h103.946l6.16 40.639L256 211.748l-57.133 27.89 4.16-40.638zM256 232.252v94.346c-5.41.103-10.833.238-16.262.402h-46.46l-21.071-52.316L256 232.252zM298.17 254c8.836 0 16 7.163 16 16s-7.164 16-16 16c-8.837 0-16-7.163-16-16s7.163-16 16-16zm-56.92 91h82.404c22.502.709 44.618 2.01 66.149 3.96-58.924 14.561-109.381 9.793-169.532-3.194A1523.33 1523.33 0 0 1 241.25 345zm-132.865 29.363c-7.943-.023-15.667.234-23.084.842l1.469 17.941c54.39-4.455 133.014 12.49 189.199 17.202 55.64 4.665 109.966-1.684 168.654-13.512l-3.557-17.645c-57.8 11.65-110.279 17.692-163.591 13.221-47.153-3.954-113.49-17.885-169.09-18.049zm20.22 35.285c-12.198-.079-25.387.615-38.517 1.873-26.26 2.518-51.6 7.157-67.865 14.26l7.203 16.496c12.302-5.372 37.244-10.427 62.38-12.838 25.138-2.41 51.157-2.311 65.846.625 32.956 6.589 91.409 16.938 138.62 15.444l-.569-17.99c-44.053 1.394-102.073-8.619-134.523-15.106-9.17-1.833-20.376-2.684-32.575-2.764z"},child:[]}]})(t)}function i1(t){return M({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M236.422 98.393c-126.642-1.276-206.07 46.77-212.058 83.93-2.977 41.18-4.165 83.628-4.016 124.617l4.31 3.796c3.963-15.315 6.47-31.843 14.122-44.085 1.3 27.18 5.068 58.562 11.369 82.067-2.477 24.988-2.118 47.99-3.436 72.978 21.158 12.726 60.485 10.65 67.541 1.986 2.936-20.695 4.981-42.58 3.973-68.535l7.592-35.355c6.418-14.587 25.29-17.243 23.406-31.799l17.828-2.467c.355 25.196-14.375 27.1-24.713 41.653 12.994 5.357 14.676 3.886 24.059 5.124 23.848 2.742 45.234 3.774 67.802-8.175l-3.101-17.541 17.723-3.135 3.064 17.328c4.22 14.097 11.996 104.392 18.559 108.361 13.411 6.417 53.823 6.417 55.472-5.312 1.647-45.786 3.861-90.1-5.07-133.242 3.702-4.1 7.34-8.112 10.928-12.096-20.178-10.157-44.214-25.838-57.62-41.797-9.037-17.21-13.75-38.688-17.304-56.256-2.546-12.943-4.3-26.074-3.81-37.486.244-5.706 1.003-11.018 2.982-15.938 19.848-20.186 56.606-35.68 79.58-46.503-33.273-7.269-71.55 7.386-99.182 17.882zm128.934-9.931c-29.757 10.977-72.215 22.174-92.633 45.267-.807 2.008-1.51 5.563-1.7 9.994-.38 8.863 1.097 21.093 3.487 33.243 2.39 12.15 5.644 24.32 8.53 33.642 1.442 4.662 2.797 8.624 3.865 11.44 15.216 22.215 45.646 39.625 67.966 44.959l14.495-28.713c-11.574-15.04-13.779-35.226-4.59-50.352 4.932-6.143 9.727-10.553 16.982-10.416 4.545.109 9.194 1.996 12.856 5.045 25.905 21.572 49.481 48.69 83.37 70.66-.136-6.626-.26-12.94-.243-18.761.026-9.03-18.924-97.759-50.614-139.553-22.918-5.83-40.343-9.14-61.771-6.455zm68.883 76.232c4.327-.07 8.421.563 11.857 2.319.061 4.922-.298 10.035-10.887 16.152-4.501-4.72-11.239-10.838-17.908-15.627 5.427-1.506 11.374-2.754 16.938-2.844zm-54.233 32.838c-2.263 3.593-3.912 11.657-2.703 17.531 1.402 6.812 9.062 16.901 21.55 26.47 12.49 9.567 29.242 18.77 46.753 26.087 15.609 6.522 31.748 11.435 46.058 14.19-49.78-25.118-79.482-61.19-108.566-85.409-1.548-1.595-2.387.034-3.092 1.131zm58.914 86.797c.526 23.427-2.416 50.265-17.086 59.894-11.128 7.306-33.235 1.34-38.41-10.925-3.657-8.667 15.567-15.677 13.408-24.832-1.718-7.287-11.033-14.374-18.375-12.912-17.881 3.558-34.905 28.836-29.3 46.185 10.14 31.387 62.177 51.105 91.875 36.75 27.49-13.288 35.058-46.714 36.808-81.19-12.704-3.13-25.983-7.579-38.92-12.97zm-200.681 52.52a129.415 129.415 0 0 1-9.993 4.34l-8.67 77.603c1.22 8.802 15.819 12.647 30.385 12.81zm-100.65 4.519c-1.341 10.733-2.367 21.785-3.073 30.953-1.545 20.225-2.483 41.562-2.496 51.49 18.869 11.927 54.798 4.533 53.105-2.005-.656-27.278-6.002-49.806-12.58-73.717-11.983-1.258-23.524-3.864-34.957-6.721z"},child:[]}]})(t)}function l1(t){return M({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M279.27 114.408l-2.297 9.184H87v18h185.473l-7.5 30h46.054l-7.5-30H489v-18H299.027l-2.297-9.184h-17.46zM26.623 173.592l14.62 87.724-12.757 38.276H44.27l32.548-32.547L197.94 284.35l2.11 4.216c7.196 14.39 18.094 25.306 28.942 32.538C239.84 328.334 251 331.592 256 331.592h128c23 0 46.04-3.978 62.346-11.225 8.152-3.623 14.546-8.035 18.63-12.703 1.744-1.993 3.066-3.993 4.034-6.072H314.066l-48-112H259l-64 48H74.437l-32-64H26.623zm259.025 16l40.286 94h44.418l-40.286-94h-44.418zm64.2.47l40.086 93.53h79.138c-7.773-34.538-24.96-56.882-47.127-71.49-20.674-13.625-46.067-20.328-72.097-22.04zm46.525 159.186c-4.108.223-8.24.344-12.373.344h-6.488l10 30h-87.024l10-30h-18.976l-10 30H199v18h251.967l24.02-17.764 7.236-5.35-10.703-14.474-7.237 5.35-19.25 14.238h-38.545l-10.115-30.344z"},child:[]}]})(t)}function c1(t){return M({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M424.188 85.594c.33.05-.86.094-3.313.094-18.512 0-35.78 20.06-35.78 47.5 0 13.83 4.712 26.208 11.624 34.78l10.217 12.626-16.062 2.47c-10.56 1.617-17.663 6.432-23.625 14.342s-10.344 19.18-13.25 32.344c-5.186 23.492-5.59 52.425-5.625 78.156h30.438l.593 8.72 7.094 106.593h65.813l8.03-106.69.657-8.624h32c-.24-25.383-1.62-53.933-7.344-77.25-3.213-13.086-7.783-24.354-13.687-32.375-5.905-8.02-12.7-12.85-22.064-14.593l-15.72-2.937 10.283-12.25c7.228-8.623 12.186-21.138 12.186-35.313 0-25.74-15.5-45.406-32.28-47.562l-.188-.03zm-244.75 3.375c-45.9.006-99.844 5.373-161.625 17.905V126c268.018-37.648 341.545 38.15 226.25 79.344-117.327 41.92-210.503 252.258 159.406 270.594 4.362.438 8.85.687 13.436.687 22.28 0 42.34-5.452 56.125-13.594 13.787-8.14 20.595-18.14 20.595-27.905s-6.808-19.764-20.594-27.906c-.23-.138-.482-.272-.717-.408l-2 26.47-.657 8.656H369l-.563-8.75-3.28-49.5c-128.194 2.8-163.256-100.51-80.094-130.47 20.385-7.344 37.086-15.836 50.187-25.03.17-.822.32-1.655.5-2.47 3.262-14.774 8.256-28.498 16.594-39.562 4.946-6.563 11.24-12.07 18.72-15.97-3.124-42.547-68.335-81.236-191.627-81.217z"},child:[]}]})(t)}function s1(t){return M({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M323.9 19.81l-55.2 55.15L285 91.24 272.2 104 256 87.73 19.81 323.9l45.57 45.6c28.5-14.6 56.22-11.7 72.52 4.6 16.3 16.3 19.2 44 4.6 72.5l45.6 45.6 236.1-236.1-16.2-16.3 12.8-12.8 16.3 16.2 55.1-55.1-45.6-45.6c-28.5 14.6-56.2 11.7-72.5-4.6-16.3-16.3-19.2-44.02-4.6-72.52zm-16.2 93.99l33.9 34-12.8 12.8-33.9-34zM256 130.2L381.8 256 222.1 415.8 96.16 289.9 249.6 136.5zm0 25.4L121.6 289.9l100.5 100.5L356.4 256zm108.2 14.8l34 33.9-12.8 12.8-34-33.9z"},child:[]}]})(t)}function d1(t){return M({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 19m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v1a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z"},child:[]},{tag:"path",attr:{d:"M12 16c3.314 0 6 -4.686 6 -8a6 6 0 1 0 -12 0c0 3.314 2.686 8 6 8z"},child:[]},{tag:"path",attr:{d:"M12 9m-2 0a2 7 0 1 0 4 0a2 7 0 1 0 -4 0"},child:[]}]})(t)}const h1=t=>M({tag:"svg",attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"1",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"},child:[]}]})(t),p1={bs:{BsBrightnessAltHigh:Je,BsFillCarFrontFill:Ue,BsFuelPump:Xe,BsHouseExclamation:Ke,BsImage:Ye},fa:{FaCampground:qe,FaCity:Qe,FaMapMarker:t1,FaTheaterMasks:e1,FaWineBottle:n1},gi:{GiBunkBeds:r1,GiBus:o1,GiCruiser:a1,GiElephant:i1,GiHelicopter:l1,GiJourney:c1,GiTicket:s1},md:{MdFestival:ue,MdHotel:me,MdKayaking:ve,MdLocationCity:ye,MdOutlineHiking:Me,MdOutlinePark:ze,MdOutlineTour:be,MdRestaurant:ge},tb:{TbAirBalloon:d1}},u1=(t,e="grey",n="grey")=>{var s;const[r,o]=t.split("/"),a=(s=p1[r])==null?void 0:s[o];return a?V.divIcon({html:`
    <div style="position: relative;">
      ${ut(i(h1,{size:32,color:e}))}
      <div style="position: absolute; top: 45%; left: 65%; transform: translate(-50%, -50%);">
        ${ut(i(a,{size:16,color:n}))}
      </div>
    </div>
  `,iconSize:[24,24],iconAnchor:[12,24],className:"custom-icon"}):(console.error(`Icon "${t}" not found in "${r}" set`),V.divIcon({html:"â“",className:"custom-icon"}))},m1=({feature:t,tabMapping:e,containerProps:n,bottomMenu:r})=>{var v;const[o,a]=w(0),s=at(),u=A(s.breakpoints.down("sm")),l=A(s.breakpoints.between("sm","md")),d=(f,h)=>{a(h)},c=(v=t.properties)!=null&&v.images?t.properties.images.map(f=>{const h=typeof f=="string"?f:f.src,m=typeof f=="string"?"":f.title;return{original:h,thumbnail:h,originalTitle:m,thumbnailTitle:m}}):[];return C("div",{style:{display:"flex",flexDirection:"column"},children:[C("div",{style:{display:"flex",flexDirection:"row",height:(n==null?void 0:n.height)||"400px"},children:[C("div",{className:G.tabsContainer,children:[C(Ct,{value:o,onChange:d,children:[Object.keys(e).map(f=>i(nt,{label:f},f)),(u||l)&&c.length>0&&i(nt,{label:"Gallery"})]}),Object.entries(e).map(([f,h],m)=>i("div",{role:"tabpanel",hidden:o!==m,id:`tabpanel-${m}`,children:o===m&&i(F,{sx:{p:1},children:h.map(g=>{if(!t.properties)return null;let p=null,y="",b="",x=!1,S=!0,O="div",H="subtitle1";return typeof g=="string"?(y=g,p=t.properties[g]):(y=g.key,p=t.properties[g.key],b=g.className||"",x=g.isHtml||!1,S=!1),S&&(typeof p=="string"||typeof p=="number"||typeof p=="boolean")?C(Z,{variant:"subtitle1",children:[C("strong",{children:[y,":"]}),C("span",{children:[" ",String(p)]})]},y):(typeof p=="object"&&p!==null&&(p=JSON.stringify(p,null,2),O="pre",H="body2"),C("div",{style:{marginBottom:"8px"},children:[i(Z,{variant:"subtitle1",children:C("strong",{children:[y,":"]})}),p&&!x&&i(Z,{component:O,variant:H,className:b,children:String(p)}),p&&x&&i(Z,{component:"div",className:b,dangerouslySetInnerHTML:{__html:p}})]},y))})})},f)),(u||l)&&c.length>0&&i("div",{role:"tabpanel",hidden:o!==Object.keys(e).length,id:`tabpanel-${Object.keys(e).length}`,style:{display:o===Object.keys(e).length?"block":"none"},children:o===Object.keys(e).length&&i(F,{sx:{p:1},children:i(mt,{items:c,showNav:!1,showPlayButton:!1})})})]}),!(u||l)&&c.length>0&&i("div",{style:{width:"50%",flex:1},children:i(mt,{items:c,showNav:!1,showPlayButton:!1})})]}),r&&i("div",{style:{height:"30px",borderTop:"1px solid #ccc",display:"flex",justifyContent:"flex-end",alignItems:"center"},children:r})]})},vt=({data:t,popupTabMapping:e,popupTabMappingExtra:n,popupOpenHandler:r,contextMenuHandler:o,popupProps:a,popupContainerProps:s,popupActionButtons:u})=>{const l=z((h,m)=>{var x,S,O,H,k,P;const g=((S=(x=h.properties)==null?void 0:x.style)==null?void 0:S.icon)||"fa/FaMapMarker",p=((H=(O=h.properties)==null?void 0:O.style)==null?void 0:H.color)||"grey",y=((P=(k=h.properties)==null?void 0:k.style)==null?void 0:P.innerIconColor)||p,b=u1(g,p,y);return V.marker(m,{icon:b})},[]),d=U(()=>({General:["name","url",{key:"description",className:G.scrollableContent}]}),[]),c=z(({feature:h,layer:m,popupTabMapping:g,popupContainerProps:p,bottomMenu:y})=>{const b=m.getPopup();if(b){const x=V.DomUtil.create("div");bt(x).render(i(m1,{feature:h,tabMapping:g,containerProps:p,bottomMenu:y})),b.setContent(x)}},[]),v=r||c,f=Object.assign({},e||d,n||{});return i(Vt,{data:t,pointToLayer:l,onEachFeature:(h,m)=>{h.properties&&(h.properties.name&&m.bindTooltip(`${h.properties.name}`,{permanent:!1,direction:"auto"}),m.bindPopup("",{...a||{}}),m.on("popupopen",()=>{const g=i(_,{children:u==null?void 0:u.map((p,y)=>i(et,{startIcon:p==null?void 0:p.startIcon,endIcon:p==null?void 0:p.endIcon,onClick:()=>{p.onClick(h)},children:p.label},y))});v({feature:h,layer:m,popupTabMapping:f,popupContainerProps:s,bottomMenu:g})}),o&&m.on("contextmenu",g=>{o({event:g,feature:h})}))}})},g1="_contextMenu_j0zss_1",f1="_contextMenuItem_j0zss_10",kt={contextMenu:g1,contextMenuItem:f1},yt=({...t})=>{const e=n=>{n.stopPropagation(),t.payload&&t.handler(t.payload),t.closeMenu&&t.closeMenu()};return i("div",{className:kt.contextMenuItem,onClick:e,children:t.title})},v1=({position:t,onClose:e,children:n,payload:r={}})=>{const[o,a]=w(!!t);E(()=>{a(!!t)},[t]);const s=()=>{a(!1),e==null||e()};return o?i("div",{className:kt.contextMenu,style:{position:"absolute",left:t==null?void 0:t.x,top:t==null?void 0:t.y},children:j.Children.map(n,u=>j.cloneElement(u,{closeMenu:s,payload:r}))}):null},y1=({...t})=>{const[e,n]=w(null),[r,o]=w(null),a=Bt({contextmenu:u=>{u.originalEvent.preventDefault(),s(u.latlng)},click:()=>{setTimeout(()=>{n(null)},100)}}),s=z(u=>{const{lat:l,lng:d}=u;o({lat:l,lng:d});const c=a.latLngToContainerPoint(u);n({x:c.x,y:c.y})},[a]);return E(()=>{t.latlng?s(t.latlng):(o(null),n(null))},[t.latlng,s]),i(_,{children:e&&i(v1,{position:e,onClose:()=>n(null),payload:{coordinates:r},children:t.children})})},b1=({...t})=>{const{addFeature:e}=rt(K),n=(o,a)=>{let s=a;if(!s){const u=prompt("Enter new name for feature"),l=o.coordinates,d=ne();s={type:"Feature",properties:{id:d,name:u||`Location ${d}`},geometry:{type:"Point",coordinates:[l.lng,l.lat]}}}return s},r=(o,a)=>{const s=n(o,a);navigator.clipboard.writeText(JSON.stringify(s,null,2)).then(()=>{tt.success("Copied feature to clipboard")}).catch(u=>{tt.error(`Failed to copy feature to clipboard. ${u}`)})};return t.menuLatLng?C(y1,{latlng:t.menuLatLng,children:[i(yt,{title:"Copy feature to clipboard",handler:o=>{r(o,t.selectedFeature)}}),i(yt,{title:"Save feature to list",handler:o=>{e("all",n(o,t.selectedFeature))}})]}):null},z1=({geoJsonOverlaySources:t,...e})=>{const{addFeature:n,savedFeatures:r}=rt(K),[o,a]=w(null),[s,u]=w(null),[l,d]=w(!1),[c,v]=w([]),[f,h]=w([]),m=U(()=>Object.keys(t),[t]),g=We(m),p=at(),y=A(p.breakpoints.down("sm")),b=A(p.breakpoints.between("sm","md")),x=A(p.breakpoints.between("md","lg")),[S,O]=w({}),[H,k]=w({});E(()=>{const I=x?600:b?450:y?275:900,N=x?450:b?400:y?350:500;O({minWidth:I,maxWidth:I,maxHeight:N,autoPanPadding:x?V.point(100,300):b?V.point(10,420):y?V.point(50,100):V.point(160,500)}),k({height:N})},[y,b,x,O,k]);const P=z(({event:I,feature:N})=>{V.DomEvent.stopPropagation(I),a(I.latlng),u(N)},[]),W=z(I=>{n("all",I),tt.success("Saved")},[n]);return E(()=>{!g.loading&&!g.error&&v(Object.entries(t).map(([I,N])=>{var $;const D=g[I];return{name:($=D==null?void 0:D.properties)==null?void 0:$.style.layerName,children:i(vt,{data:D,popupTabMapping:N,contextMenuHandler:P,popupProps:S,popupContainerProps:H,popupActionButtons:[{label:"Save",startIcon:i(he,{}),onClick:W}]})}}))},[t,g,P,S,H,W]),E(()=>{h(Object.entries(r).map(([I,N])=>({name:`- ${I}`,children:i(vt,{data:{type:"FeatureCollection",features:N,properties:{}},contextMenuHandler:P,popupProps:S,popupTabMappingExtra:{Notes:[{key:"tripNotes",className:G.scrollableContent,isHtml:!0}]},popupContainerProps:H},Date.now())})))},[r,P,S,H]),C(_,{children:[i(Oe,{overlays:[...c,...f],...e,children:i(b1,{selectedFeature:s,menuLatLng:o})}),i(Re,{drawerOpen:l,onClose:()=>d(!l)})]})},M1=()=>{const t=U(()=>({lat:-31.953512,lng:115.857048}),[]),e=U(()=>({"./markers/westernAustralia/gas_stations_openstreetmap.json":{General:["name","brand","operator","opening_hours"]},"./markers/westernAustralia/gas_stations_fuelwatch.json":{General:["name","brandName","manned","operates247"]},"./markers/westernAustralia/gas_stations_bp.json":{General:["name","address",{key:"facilities",className:G.scrollableContent}],"More Info":[{key:"products",className:G.scrollableContent},"website","telephone"]},"./markers/westernAustralia/national_parks_simplified.json":{General:["name","url",{key:"description",className:G.scrollableContent}]},"./markers/westernAustralia/accommodation_WA.json":{General:["name","website","tarif","isBookable"],"More Info":["operatorName","GroupName","CheckInTime","CheckOutTime","email","address","hours"]},"./markers/westernAustralia/accommodation_campermate.json":{General:["name","fees","bookable",{key:"description",className:G.scrollableContent}],Score:["score","thumbs_up","thumbs_down"]},"./markers/westernAustralia/western_australia_tourism.json":{General:["name","url",{key:"description",className:G.scrollableContent}]},"./markers/westernAustralia/western_australia_visitor_centre.json":{General:["name","type",{key:"description",className:G.scrollableContent},{key:"pointOfDifference",className:G.scrollableContent}],Info:["address","hours","email","website"]},"./markers/westernAustralia/places.json":{General:["name"]}}),[]);return i(z1,{center:t,geoJsonOverlaySources:e})};function C1(){return i(_,{children:i(re,{children:i(M1,{})})})}bt(document.getElementById("root")).render(C(j.StrictMode,{children:[i(C1,{}),i(Pt,{})]}));
